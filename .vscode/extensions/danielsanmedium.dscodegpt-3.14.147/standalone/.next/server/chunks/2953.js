try{let a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},b=(new a.Error).stack;b&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[b]="d94b241c-b6a2-4eaf-b272-3c119255e871",a._sentryDebugIdIdentifier="sentry-dbid-d94b241c-b6a2-4eaf-b272-3c119255e871")}catch(a){}"use strict";exports.id=2953,exports.ids=[2953],exports.modules={12953:(a,b,c)=>{let d,e,f,g,h,i,j,k,l,m,n;c.d(b,{AC:()=>et,Ay:()=>ew});let o="RFC3986",p={RFC1738:a=>String(a).replace(/%20/g,"+"),RFC3986:a=>String(a)};Object.prototype.hasOwnProperty;let q=Array.isArray,r=(()=>{let a=[];for(let b=0;b<256;++b)a.push("%"+((b<16?"0":"")+b.toString(16)).toUpperCase());return a})();function s(a,b){if(q(a)){let c=[];for(let d=0;d<a.length;d+=1)c.push(b(a[d]));return c}return b(a)}let t=Object.prototype.hasOwnProperty,u={brackets:a=>String(a)+"[]",comma:"comma",indices:(a,b)=>String(a)+"["+b+"]",repeat:a=>String(a)},v=Array.isArray,w=Array.prototype.push,x=function(a,b){w.apply(a,v(b)?b:[b])},y=Date.prototype.toISOString,z={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(a,b,c,d,e)=>{if(0===a.length)return a;let f=a;if("symbol"==typeof a?f=Symbol.prototype.toString.call(a):"string"!=typeof a&&(f=String(a)),"iso-8859-1"===c)return escape(f).replace(/%u[0-9a-f]{4}/gi,function(a){return"%26%23"+parseInt(a.slice(2),16)+"%3B"});let g="";for(let a=0;a<f.length;a+=1024){let b=f.length>=1024?f.slice(a,a+1024):f,c=[];for(let a=0;a<b.length;++a){let d=b.charCodeAt(a);if(45===d||46===d||95===d||126===d||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||"RFC1738"===e&&(40===d||41===d)){c[c.length]=b.charAt(a);continue}if(d<128){c[c.length]=r[d];continue}if(d<2048){c[c.length]=r[192|d>>6]+r[128|63&d];continue}if(d<55296||d>=57344){c[c.length]=r[224|d>>12]+r[128|d>>6&63]+r[128|63&d];continue}a+=1,d=65536+((1023&d)<<10|1023&b.charCodeAt(a)),c[c.length]=r[240|d>>18]+r[128|d>>12&63]+r[128|d>>6&63]+r[128|63&d]}g+=c.join("")}return g},encodeValuesOnly:!1,format:o,formatter:p[o],indices:!1,serializeDate:a=>y.call(a),skipNulls:!1,strictNullHandling:!1},A={},B="4.104.0",C=!1;var D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO=c(27910),aP=c(81630),aQ=c(79551),aR=c(70236),aS=c(55591),aT=c(74075);let aU=aO.Readable,aV=Symbol("buffer"),aW=Symbol("type");class aX{constructor(){this[aW]="";let a=arguments[0],b=arguments[1],c=[];if(a){let b=Number(a.length);for(let d=0;d<b;d++){let b,e=a[d];(b=e instanceof Buffer?e:ArrayBuffer.isView(e)?Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer?Buffer.from(e):e instanceof aX?e[aV]:Buffer.from("string"==typeof e?e:String(e))).length,c.push(b)}}this[aV]=Buffer.concat(c);let d=b&&void 0!==b.type&&String(b.type).toLowerCase();d&&!/[^\u0020-\u007E]/.test(d)&&(this[aW]=d)}get size(){return this[aV].length}get type(){return this[aW]}text(){return Promise.resolve(this[aV].toString())}arrayBuffer(){let a=this[aV];return Promise.resolve(a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength))}stream(){let a=new aU;return a._read=function(){},a.push(this[aV]),a.push(null),a}toString(){return"[object Blob]"}slice(){let a,b=this.size,c=arguments[0],d=arguments[1];a=void 0===c?0:c<0?Math.max(b+c,0):Math.min(c,b);let e=Math.max((void 0===d?b:d<0?Math.max(b+d,0):Math.min(d,b))-a,0),f=this[aV].slice(a,a+e),g=new aX([],{type:arguments[2]});return g[aV]=f,g}}function aY(a,b,c){Error.call(this,a),this.message=a,this.type=b,c&&(this.code=this.errno=c.code),Error.captureStackTrace(this,this.constructor)}Object.defineProperties(aX.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(aX.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0}),aY.prototype=Object.create(Error.prototype),aY.prototype.constructor=aY,aY.prototype.name="FetchError";try{d=require("encoding").convert}catch(a){}let aZ=Symbol("Body internals"),a$=aO.PassThrough;function a_(a){var b=this,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=c.size,e=c.timeout;null==a?a=null:a1(a)?a=Buffer.from(a.toString()):a2(a)||Buffer.isBuffer(a)||("[object ArrayBuffer]"===Object.prototype.toString.call(a)?a=Buffer.from(a):ArrayBuffer.isView(a)?a=Buffer.from(a.buffer,a.byteOffset,a.byteLength):a instanceof aO||(a=Buffer.from(String(a)))),this[aZ]={body:a,disturbed:!1,error:null},this.size=void 0===d?0:d,this.timeout=void 0===e?0:e,a instanceof aO&&a.on("error",function(a){let c="AbortError"===a.name?a:new aY(`Invalid response body while trying to fetch ${b.url}: ${a.message}`,"system",a);b[aZ].error=c})}function a0(){var a=this;if(this[aZ].disturbed)return a_.Promise.reject(TypeError(`body used already for: ${this.url}`));if(this[aZ].disturbed=!0,this[aZ].error)return a_.Promise.reject(this[aZ].error);let b=this.body;if(null===b)return a_.Promise.resolve(Buffer.alloc(0));if(a2(b)&&(b=b.stream()),Buffer.isBuffer(b))return a_.Promise.resolve(b);if(!(b instanceof aO))return a_.Promise.resolve(Buffer.alloc(0));let c=[],d=0,e=!1;return new a_.Promise(function(f,g){let h;a.timeout&&(h=setTimeout(function(){e=!0,g(new aY(`Response timeout while trying to fetch ${a.url} (over ${a.timeout}ms)`,"body-timeout"))},a.timeout)),b.on("error",function(b){"AbortError"===b.name?(e=!0,g(b)):g(new aY(`Invalid response body while trying to fetch ${a.url}: ${b.message}`,"system",b))}),b.on("data",function(b){if(!e&&null!==b){if(a.size&&d+b.length>a.size){e=!0,g(new aY(`content size at ${a.url} over limit: ${a.size}`,"max-size"));return}d+=b.length,c.push(b)}}),b.on("end",function(){if(!e){clearTimeout(h);try{f(Buffer.concat(c,d))}catch(b){g(new aY(`Could not create Buffer from response body for ${a.url}: ${b.message}`,"system",b))}}})})}function a1(a){return"object"==typeof a&&"function"==typeof a.append&&"function"==typeof a.delete&&"function"==typeof a.get&&"function"==typeof a.getAll&&"function"==typeof a.has&&"function"==typeof a.set&&("URLSearchParams"===a.constructor.name||"[object URLSearchParams]"===Object.prototype.toString.call(a)||"function"==typeof a.sort)}function a2(a){return"object"==typeof a&&"function"==typeof a.arrayBuffer&&"string"==typeof a.type&&"function"==typeof a.stream&&"function"==typeof a.constructor&&"string"==typeof a.constructor.name&&/^(Blob|File)$/.test(a.constructor.name)&&/^(Blob|File)$/.test(a[Symbol.toStringTag])}function a3(a){let b,c,d=a.body;if(a.bodyUsed)throw Error("cannot clone body after it is used");return d instanceof aO&&"function"!=typeof d.getBoundary&&(b=new a$,c=new a$,d.pipe(b),d.pipe(c),a[aZ].body=b,d=c),d}function a4(a){if(null===a)return null;if("string"==typeof a)return"text/plain;charset=UTF-8";if(a1(a))return"application/x-www-form-urlencoded;charset=UTF-8";if(a2(a))return a.type||null;if(Buffer.isBuffer(a))return null;else if("[object ArrayBuffer]"===Object.prototype.toString.call(a))return null;else if(ArrayBuffer.isView(a))return null;else if("function"==typeof a.getBoundary)return`multipart/form-data;boundary=${a.getBoundary()}`;else if(a instanceof aO)return null;else return"text/plain;charset=UTF-8"}function a5(a){let b=a.body;return null===b?0:a2(b)?b.size:Buffer.isBuffer(b)?b.length:b&&"function"==typeof b.getLengthSync?b._lengthRetrievers&&0==b._lengthRetrievers.length||b.hasKnownLength&&b.hasKnownLength()?b.getLengthSync():null:null}a_.prototype={get body(){return this[aZ].body},get bodyUsed(){return this[aZ].disturbed},arrayBuffer(){return a0.call(this).then(function(a){return a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength)})},blob(){let a=this.headers&&this.headers.get("content-type")||"";return a0.call(this).then(function(b){return Object.assign(new aX([],{type:a.toLowerCase()}),{[aV]:b})})},json(){var a=this;return a0.call(this).then(function(b){try{return JSON.parse(b.toString())}catch(b){return a_.Promise.reject(new aY(`invalid json response body at ${a.url} reason: ${b.message}`,"invalid-json"))}})},text(){return a0.call(this).then(function(a){return a.toString()})},buffer(){return a0.call(this)},textConverted(){var a=this;return a0.call(this).then(function(b){return function(a,b){let c,e;if("function"!=typeof d)throw Error("The package `encoding` must be installed to use the textConverted() function");let f=b.get("content-type"),g="utf-8";return f&&(c=/charset=([^;]*)/i.exec(f)),e=a.slice(0,1024).toString(),!c&&e&&(c=/<meta.+?charset=(['"])(.+?)\1/i.exec(e)),!c&&e&&(!(c=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(e))&&(c=/<meta[\s]+?content=(['"])(.+?)\1[\s]+?http-equiv=(['"])content-type\3/i.exec(e))&&c.pop(),c&&(c=/charset=(.*)/i.exec(c.pop()))),!c&&e&&(c=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(e)),c&&("gb2312"===(g=c.pop())||"gbk"===g)&&(g="gb18030"),d(a,"UTF-8",g).toString()}(b,a.headers)})}},Object.defineProperties(a_.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),a_.mixIn=function(a){for(let b of Object.getOwnPropertyNames(a_.prototype))if(!(b in a)){let c=Object.getOwnPropertyDescriptor(a_.prototype,b);Object.defineProperty(a,b,c)}},a_.Promise=global.Promise;let a6=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,a7=/[^\t\x20-\x7e\x80-\xff]/;function a8(a){if(a=`${a}`,a6.test(a)||""===a)throw TypeError(`${a} is not a legal HTTP header name`)}function a9(a){if(a=`${a}`,a7.test(a))throw TypeError(`${a} is not a legal HTTP header value`)}function ba(a,b){for(let c in b=b.toLowerCase(),a)if(c.toLowerCase()===b)return c}let bb=Symbol("map");class bc{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this[bb]=Object.create(null),a instanceof bc){let b=a.raw();for(let a of Object.keys(b))for(let c of b[a])this.append(a,c);return}if(null==a);else if("object"==typeof a){let b=a[Symbol.iterator];if(null!=b){if("function"!=typeof b)throw TypeError("Header pairs must be iterable");let c=[];for(let b of a){if("object"!=typeof b||"function"!=typeof b[Symbol.iterator])throw TypeError("Each header pair must be iterable");c.push(Array.from(b))}for(let a of c){if(2!==a.length)throw TypeError("Each header pair must be a name/value tuple");this.append(a[0],a[1])}}else for(let b of Object.keys(a)){let c=a[b];this.append(b,c)}}else throw TypeError("Provided initializer must be an object")}get(a){a8(a=`${a}`);let b=ba(this[bb],a);return void 0===b?null:this[bb][b].join(", ")}forEach(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,c=bd(this),d=0;for(;d<c.length;){var e=c[d];let f=e[0],g=e[1];a.call(b,g,f,this),c=bd(this),d++}}set(a,b){a=`${a}`,b=`${b}`,a8(a),a9(b);let c=ba(this[bb],a);this[bb][void 0!==c?c:a]=[b]}append(a,b){a=`${a}`,b=`${b}`,a8(a),a9(b);let c=ba(this[bb],a);void 0!==c?this[bb][c].push(b):this[bb][a]=[b]}has(a){return a8(a=`${a}`),void 0!==ba(this[bb],a)}delete(a){a8(a=`${a}`);let b=ba(this[bb],a);void 0!==b&&delete this[bb][b]}raw(){return this[bb]}keys(){return bf(this,"key")}values(){return bf(this,"value")}[Symbol.iterator](){return bf(this,"key+value")}}function bd(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key+value";return Object.keys(a[bb]).sort().map("key"===b?function(a){return a.toLowerCase()}:"value"===b?function(b){return a[bb][b].join(", ")}:function(b){return[b.toLowerCase(),a[bb][b].join(", ")]})}bc.prototype.entries=bc.prototype[Symbol.iterator],Object.defineProperty(bc.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(bc.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});let be=Symbol("internal");function bf(a,b){let c=Object.create(bg);return c[be]={target:a,kind:b,index:0},c}let bg=Object.setPrototypeOf({next(){if(!this||Object.getPrototypeOf(this)!==bg)throw TypeError("Value of `this` is not a HeadersIterator");var a=this[be];let b=a.target,c=a.kind,d=a.index,e=bd(b,c);return d>=e.length?{value:void 0,done:!0}:(this[be].index=d+1,{value:e[d],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));Object.defineProperty(bg,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});let bh=Symbol("Response internals"),bi=aP.STATUS_CODES;class bj{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a_.call(this,a,b);let c=b.status||200,d=new bc(b.headers);if(null!=a&&!d.has("Content-Type")){let b=a4(a);b&&d.append("Content-Type",b)}this[bh]={url:b.url,status:c,statusText:b.statusText||bi[c],headers:d,counter:b.counter}}get url(){return this[bh].url||""}get status(){return this[bh].status}get ok(){return this[bh].status>=200&&this[bh].status<300}get redirected(){return this[bh].counter>0}get statusText(){return this[bh].statusText}get headers(){return this[bh].headers}clone(){return new bj(a3(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected})}}a_.mixIn(bj.prototype),Object.defineProperties(bj.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty(bj.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});let bk=Symbol("Request internals"),bl=aQ.URL||aR.URL,bm=aQ.parse,bn=aQ.format;function bo(a){return/^[a-zA-Z][a-zA-Z\d+\-.]*:/.exec(a)&&(a=new bl(a).toString()),bm(a)}let bp="destroy"in aO.Readable.prototype;function bq(a){return"object"==typeof a&&"object"==typeof a[bk]}class br{constructor(a){let b,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};bq(a)?b=bo(a.url):(b=a&&a.href?bo(a.href):bo(`${a}`),a={});let d=c.method||a.method||"GET";if(d=d.toUpperCase(),(null!=c.body||bq(a)&&null!==a.body)&&("GET"===d||"HEAD"===d))throw TypeError("Request with GET/HEAD method cannot have body");let e=null!=c.body?c.body:bq(a)&&null!==a.body?a3(a):null;a_.call(this,e,{timeout:c.timeout||a.timeout||0,size:c.size||a.size||0});let f=new bc(c.headers||a.headers||{});if(null!=e&&!f.has("Content-Type")){let a=a4(e);a&&f.append("Content-Type",a)}let g=bq(a)?a.signal:null;if("signal"in c&&(g=c.signal),null!=g&&!function(a){let b=a&&"object"==typeof a&&Object.getPrototypeOf(a);return!!(b&&"AbortSignal"===b.constructor.name)}(g))throw TypeError("Expected signal to be an instanceof AbortSignal");this[bk]={method:d,redirect:c.redirect||a.redirect||"follow",headers:f,parsedURL:b,signal:g},this.follow=void 0!==c.follow?c.follow:void 0!==a.follow?a.follow:20,this.compress=void 0!==c.compress?c.compress:void 0===a.compress||a.compress,this.counter=c.counter||a.counter||0,this.agent=c.agent||a.agent}get method(){return this[bk].method}get url(){return bn(this[bk].parsedURL)}get headers(){return this[bk].headers}get redirect(){return this[bk].redirect}get signal(){return this[bk].signal}clone(){return new br(this)}}function bs(a){Error.call(this,a),this.type="aborted",this.message=a,Error.captureStackTrace(this,this.constructor)}a_.mixIn(br.prototype),Object.defineProperty(br.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(br.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}}),bs.prototype=Object.create(Error.prototype),bs.prototype.constructor=bs,bs.prototype.name="AbortError";let bt=aQ.URL||aR.URL,bu=aO.PassThrough,bv=function(a,b){let c=new bt(b).hostname,d=new bt(a).hostname;return c===d||"."===c[c.length-d.length-1]&&c.endsWith(d)};function bw(a,b){if(!bw.Promise)throw Error("native promise missing, set fetch.Promise to your favorite alternative");return a_.Promise=bw.Promise,new bw.Promise(function(c,d){var e,f;let g,h,i=new br(a,b),j=function(a){let b=a[bk].parsedURL,c=new bc(a[bk].headers);if(c.has("Accept")||c.set("Accept","*/*"),!b.protocol||!b.hostname)throw TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(b.protocol))throw TypeError("Only HTTP(S) protocols are supported");if(a.signal&&a.body instanceof aO.Readable&&!bp)throw Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8");let d=null;if(null==a.body&&/^(POST|PUT)$/i.test(a.method)&&(d="0"),null!=a.body){let b=a5(a);"number"==typeof b&&(d=String(b))}d&&c.set("Content-Length",d),c.has("User-Agent")||c.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),a.compress&&!c.has("Accept-Encoding")&&c.set("Accept-Encoding","gzip,deflate");let e=a.agent;return"function"==typeof e&&(e=e(b)),Object.assign({},b,{method:a.method,headers:function(a){let b=Object.assign({__proto__:null},a[bb]),c=ba(a[bb],"Host");return void 0!==c&&(b[c]=b[c][0]),b}(c),agent:e})}(i),k=("https:"===j.protocol?aS:aP).request,l=i.signal,m=null,n=function(){let a=new bs("The user aborted a request.");d(a),i.body&&i.body instanceof aO.Readable&&bx(i.body,a),m&&m.body&&m.body.emit("error",a)};if(l&&l.aborted)return void n();let o=function(){n(),q()},p=k(j);function q(){p.abort(),l&&l.removeEventListener("abort",o),clearTimeout(g)}l&&l.addEventListener("abort",o),i.timeout&&p.once("socket",function(a){g=setTimeout(function(){d(new aY(`network timeout at: ${i.url}`,"request-timeout")),q()},i.timeout)}),p.on("error",function(a){d(new aY(`request to ${i.url} failed, reason: ${a.message}`,"system",a)),m&&m.body&&bx(m.body,a),q()}),e=p,f=function(a){(!l||!l.aborted)&&m&&m.body&&bx(m.body,a)},e.on("socket",function(a){h=a}),e.on("response",function(a){let b=a.headers;"chunked"!==b["transfer-encoding"]||b["content-length"]||a.once("close",function(a){if(h&&h.listenerCount("data")>0&&!a){let a=Error("Premature close");a.code="ERR_STREAM_PREMATURE_CLOSE",f(a)}})}),14>parseInt(process.version.substring(1))&&p.on("socket",function(a){a.addListener("close",function(b){let c=a.listenerCount("data")>0;if(m&&c&&!b&&!(l&&l.aborted)){let a=Error("Premature close");a.code="ERR_STREAM_PREMATURE_CLOSE",m.body.emit("error",a)}})}),p.on("response",function(a){clearTimeout(g);let b=function(a){let b=new bc;for(let c of Object.keys(a))if(!a6.test(c))if(Array.isArray(a[c]))for(let d of a[c])a7.test(d)||(void 0===b[bb][c]?b[bb][c]=[d]:b[bb][c].push(d));else a7.test(a[c])||(b[bb][c]=[a[c]]);return b}(a.headers);if(bw.isRedirect(a.statusCode)){let f=b.get("Location"),g=null;try{g=null===f?null:new bt(f,i.url).toString()}catch(a){if("manual"!==i.redirect){d(new aY(`uri requested responds with an invalid redirect URL: ${f}`,"invalid-redirect")),q();return}}switch(i.redirect){case"error":d(new aY(`uri requested responds with a redirect, redirect mode is set to error: ${i.url}`,"no-redirect")),q();return;case"manual":if(null!==g)try{b.set("Location",g)}catch(a){d(a)}break;case"follow":var e;if(null===g)break;if(i.counter>=i.follow){d(new aY(`maximum redirect reached at: ${i.url}`,"max-redirect")),q();return}let h={headers:new bc(i.headers),follow:i.follow,counter:i.counter+1,agent:i.agent,compress:i.compress,method:i.method,body:i.body,signal:i.signal,timeout:i.timeout,size:i.size};if(!bv(i.url,g)||(e=i.url,new bt(g).protocol!==new bt(e).protocol))for(let a of["authorization","www-authenticate","cookie","cookie2"])h.headers.delete(a);if(303!==a.statusCode&&i.body&&null===a5(i)){d(new aY("Cannot follow redirect with body being a readable stream","unsupported-redirect")),q();return}(303===a.statusCode||(301===a.statusCode||302===a.statusCode)&&"POST"===i.method)&&(h.method="GET",h.body=void 0,h.headers.delete("content-length")),c(bw(new br(g,h))),q();return}}a.once("end",function(){l&&l.removeEventListener("abort",o)});let f=a.pipe(new bu),h={url:i.url,status:a.statusCode,statusText:a.statusMessage,headers:b,size:i.size,timeout:i.timeout,counter:i.counter},j=b.get("Content-Encoding");if(!i.compress||"HEAD"===i.method||null===j||204===a.statusCode||304===a.statusCode)return void c(m=new bj(f,h));let k={flush:aT.Z_SYNC_FLUSH,finishFlush:aT.Z_SYNC_FLUSH};if("gzip"==j||"x-gzip"==j)return void c(m=new bj(f=f.pipe(aT.createGunzip(k)),h));if("deflate"==j||"x-deflate"==j){let b=a.pipe(new bu);b.once("data",function(a){c(m=new bj(f=(15&a[0])==8?f.pipe(aT.createInflate()):f.pipe(aT.createInflateRaw()),h))}),b.on("end",function(){m||c(m=new bj(f,h))});return}if("br"==j&&"function"==typeof aT.createBrotliDecompress)return void c(m=new bj(f=f.pipe(aT.createBrotliDecompress()),h));c(m=new bj(f,h))});let r=i.body;null===r?p.end():a2(r)?r.stream().pipe(p):Buffer.isBuffer(r)?(p.write(r),p.end()):r.pipe(p)})}function bx(a,b){a.destroy?a.destroy(b):(a.emit("error",b),a.end())}bw.isRedirect=function(a){return 301===a||302===a||303===a||307===a||308===a},bw.Promise=global.Promise;var by=c(70457),bz=c(80235),bA=c(86955),bB=c(73024),bC=c(15202),bD=c(57075);class bE{constructor(a){this.body=a}get[Symbol.toStringTag](){return"MultipartBody"}}var bF=c(37830);let bG=!1;async function bH(a,...b){let{fileFromPath:d}=await c.e(3517).then(c.bind(c,83517));return bG||(console.warn(`fileFromPath is deprecated; use fs.createReadStream(${JSON.stringify(a)}) instead`),bG=!0),await d(a,...b)}let bI=new bz({keepAlive:!0,timeout:3e5}),bJ=new bz.HttpsAgent({keepAlive:!0,timeout:3e5});async function bK(a,b){let c=new bC.Vi(a),d=new bE(bD.Readable.from(c)),e={...b.headers,...c.headers,"Content-Length":c.contentLength};return{...b,body:d,headers:e}}let bL=()=>{f||function(a,b={auto:!1}){if(C)throw Error(`you must \`import 'openai/shims/${a.kind}'\` before importing anything else from openai`);if(f)throw Error(`can't \`import 'openai/shims/${a.kind}'\` after \`import 'openai/shims/${f}'\``);C=b.auto,f=a.kind,g=a.fetch,a.Request,a.Response,a.Headers,h=a.FormData,a.Blob,i=a.File,j=a.ReadableStream,k=a.getMultipartRequestOptions,l=a.getDefaultAgent,m=a.fileFromPath,n=a.isFsReadStream}(("undefined"==typeof AbortController&&(globalThis.AbortController=bA.AbortController),{kind:"node",fetch:bw,Request:br,Response:bj,Headers:bc,FormData:by.fS,Blob:by.YQ,File:by.ZH,ReadableStream:bF.ReadableStream,getMultipartRequestOptions:bK,getDefaultAgent:a=>a.startsWith("https")?bJ:bI,fileFromPath:bH,isFsReadStream:a=>a instanceof bB.ReadStream}),{auto:!0})};bL();class bM extends Error{}class bN extends bM{constructor(a,b,c,d){super(`${bN.makeMessage(a,b,c)}`),this.status=a,this.headers=d,this.request_id=d?.["x-request-id"],this.error=b,this.code=b?.code,this.param=b?.param,this.type=b?.type}static makeMessage(a,b,c){let d=b?.message?"string"==typeof b.message?b.message:JSON.stringify(b.message):b?JSON.stringify(b):c;return a&&d?`${a} ${d}`:a?`${a} status code (no body)`:d||"(no status code or body)"}static generate(a,b,c,d){if(!a||!d)return new bP({message:c,cause:cD(b)});let e=b?.error;return 400===a?new bR(a,e,c,d):401===a?new bS(a,e,c,d):403===a?new bT(a,e,c,d):404===a?new bU(a,e,c,d):409===a?new bV(a,e,c,d):422===a?new bW(a,e,c,d):429===a?new bX(a,e,c,d):a>=500?new bY(a,e,c,d):new bN(a,e,c,d)}}class bO extends bN{constructor({message:a}={}){super(void 0,void 0,a||"Request was aborted.",void 0)}}class bP extends bN{constructor({message:a,cause:b}){super(void 0,void 0,a||"Connection error.",void 0),b&&(this.cause=b)}}class bQ extends bP{constructor({message:a}={}){super({message:a??"Request timed out."})}}class bR extends bN{}class bS extends bN{}class bT extends bN{}class bU extends bN{}class bV extends bN{}class bW extends bN{}class bX extends bN{}class bY extends bN{}class bZ extends bM{constructor(){super("Could not parse response content as the length limit was reached")}}class b$ extends bM{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var b_=function(a,b,c,d,e){if("m"===d)throw TypeError("Private method is not writable");if("a"===d&&!e)throw TypeError("Private accessor was defined without a setter");if("function"==typeof b?a!==b||!e:!b.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===d?e.call(a,c):e?e.value=c:b.set(a,c),c},b0=function(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)};class b1{constructor(){D.set(this,void 0),this.buffer=new Uint8Array,b_(this,D,null,"f")}decode(a){let b;if(null==a)return[];let c=a instanceof ArrayBuffer?new Uint8Array(a):"string"==typeof a?new TextEncoder().encode(a):a,d=new Uint8Array(this.buffer.length+c.length);d.set(this.buffer),d.set(c,this.buffer.length),this.buffer=d;let e=[];for(;null!=(b=function(a,b){for(let c=b??0;c<a.length;c++){if(10===a[c])return{preceding:c,index:c+1,carriage:!1};if(13===a[c])return{preceding:c,index:c+1,carriage:!0}}return null}(this.buffer,b0(this,D,"f")));){if(b.carriage&&null==b0(this,D,"f")){b_(this,D,b.index,"f");continue}if(null!=b0(this,D,"f")&&(b.index!==b0(this,D,"f")+1||b.carriage)){e.push(this.decodeText(this.buffer.slice(0,b0(this,D,"f")-1))),this.buffer=this.buffer.slice(b0(this,D,"f")),b_(this,D,null,"f");continue}let a=null!==b0(this,D,"f")?b.preceding-1:b.preceding,c=this.decodeText(this.buffer.slice(0,a));e.push(c),this.buffer=this.buffer.slice(b.index),b_(this,D,null,"f")}return e}decodeText(a){if(null==a)return"";if("string"==typeof a)return a;if("undefined"!=typeof Buffer){if(a instanceof Buffer)return a.toString();if(a instanceof Uint8Array)return Buffer.from(a).toString();throw new bM(`Unexpected: received non-Uint8Array (${a.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(a instanceof Uint8Array||a instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(a);throw new bM(`Unexpected: received non-Uint8Array/ArrayBuffer (${a.constructor.name}) in a web platform. Please report this error.`)}throw new bM("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode("\n"):[]}}function b2(a){if(a[Symbol.asyncIterator])return a;let b=a.getReader();return{async next(){try{let a=await b.read();return a?.done&&b.releaseLock(),a}catch(a){throw b.releaseLock(),a}},async return(){let a=b.cancel();return b.releaseLock(),await a,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}D=new WeakMap,b1.NEWLINE_CHARS=new Set(["\n","\r"]),b1.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class b3{constructor(a,b){this.iterator=a,this.controller=b}static fromSSEResponse(a,b){let c=!1;async function*d(){if(c)throw Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");c=!0;let d=!1;try{for await(let c of b4(a,b))if(!d){if(c.data.startsWith("[DONE]")){d=!0;continue}if(null===c.event||c.event.startsWith("response.")||c.event.startsWith("transcript.")){let b;try{b=JSON.parse(c.data)}catch(a){throw console.error("Could not parse message into JSON:",c.data),console.error("From chunk:",c.raw),a}if(b&&b.error)throw new bN(void 0,b.error,void 0,cs(a.headers));yield b}else{let a;try{a=JSON.parse(c.data)}catch(a){throw console.error("Could not parse message into JSON:",c.data),console.error("From chunk:",c.raw),a}if("error"==c.event)throw new bN(void 0,a.error,a.message,void 0);yield{event:c.event,data:a}}}d=!0}catch(a){if(a instanceof Error&&"AbortError"===a.name)return;throw a}finally{d||b.abort()}}return new b3(d,b)}static fromReadableStream(a,b){let c=!1;async function*d(){let b=new b1;for await(let c of b2(a))for(let a of b.decode(c))yield a;for(let a of b.flush())yield a}return new b3(async function*(){if(c)throw Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");c=!0;let a=!1;try{for await(let b of d())!a&&b&&(yield JSON.parse(b));a=!0}catch(a){if(a instanceof Error&&"AbortError"===a.name)return;throw a}finally{a||b.abort()}},b)}[Symbol.asyncIterator](){return this.iterator()}tee(){let a=[],b=[],c=this.iterator(),d=d=>({next:()=>{if(0===d.length){let d=c.next();a.push(d),b.push(d)}return d.shift()}});return[new b3(()=>d(a),this.controller),new b3(()=>d(b),this.controller)]}toReadableStream(){let a,b=this,c=new TextEncoder;return new j({async start(){a=b[Symbol.asyncIterator]()},async pull(b){try{let{value:d,done:e}=await a.next();if(e)return b.close();let f=c.encode(JSON.stringify(d)+"\n");b.enqueue(f)}catch(a){b.error(a)}},async cancel(){await a.return?.()}})}}async function*b4(a,b){if(!a.body)throw b.abort(),new bM("Attempted to iterate over a response with no body");let c=new b6,d=new b1;for await(let b of b5(b2(a.body)))for(let a of d.decode(b)){let b=c.decode(a);b&&(yield b)}for(let a of d.flush()){let b=c.decode(a);b&&(yield b)}}async function*b5(a){let b=new Uint8Array;for await(let c of a){let a;if(null==c)continue;let d=c instanceof ArrayBuffer?new Uint8Array(c):"string"==typeof c?new TextEncoder().encode(c):c,e=new Uint8Array(b.length+d.length);for(e.set(b),e.set(d,b.length),b=e;-1!==(a=function(a){for(let b=0;b<a.length-1;b++){if(10===a[b]&&10===a[b+1]||13===a[b]&&13===a[b+1])return b+2;if(13===a[b]&&10===a[b+1]&&b+3<a.length&&13===a[b+2]&&10===a[b+3])return b+4}return -1}(b));)yield b.slice(0,a),b=b.slice(a)}b.length>0&&(yield b)}class b6{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(a){if(a.endsWith("\r")&&(a=a.substring(0,a.length-1)),!a){if(!this.event&&!this.data.length)return null;let a={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(a),a.startsWith(":"))return null;let[b,c,d]=function(a,b){let c=a.indexOf(":");return -1!==c?[a.substring(0,c),b,a.substring(c+b.length)]:[a,"",""]}(a,":");return d.startsWith(" ")&&(d=d.substring(1)),"event"===b?this.event=d:"data"===b&&this.data.push(d),null}}let b7=a=>null!=a&&"object"==typeof a&&"string"==typeof a.url&&"function"==typeof a.blob,b8=a=>null!=a&&"object"==typeof a&&"string"==typeof a.name&&"number"==typeof a.lastModified&&b9(a),b9=a=>null!=a&&"object"==typeof a&&"number"==typeof a.size&&"string"==typeof a.type&&"function"==typeof a.text&&"function"==typeof a.slice&&"function"==typeof a.arrayBuffer,ca=a=>b8(a)||b7(a)||n(a);async function cb(a,b,c){var d;if(b8(a=await a))return a;if(b7(a)){let d=await a.blob();b||(b=new URL(a.url).pathname.split(/[\\/]/).pop()??"unknown_file");let e=b9(d)?[await d.arrayBuffer()]:[d];return new i(e,b,c)}let e=await cc(a);if(b||(b=(cd((d=a).name)||cd(d.filename)||cd(d.path)?.split(/[\\/]/).pop())??"unknown_file"),!c?.type){let a=e[0]?.type;"string"==typeof a&&(c={...c,type:a})}return new i(e,b,c)}async function cc(a){let b=[];if("string"==typeof a||ArrayBuffer.isView(a)||a instanceof ArrayBuffer)b.push(a);else if(b9(a))b.push(await a.arrayBuffer());else if(ce(a))for await(let c of a)b.push(c);else throw Error(`Unexpected data type: ${typeof a}; constructor: ${a?.constructor?.name}; props: ${function(a){let b=Object.getOwnPropertyNames(a);return`[${b.map(a=>`"${a}"`).join(", ")}]`}(a)}`);return b}let cd=a=>"string"==typeof a?a:"undefined"!=typeof Buffer&&a instanceof Buffer?String(a):void 0,ce=a=>null!=a&&"object"==typeof a&&"function"==typeof a[Symbol.asyncIterator],cf=a=>a&&"object"==typeof a&&a.body&&"MultipartBody"===a[Symbol.toStringTag],cg=async a=>{let b=await ch(a.body);return k(b,a)},ch=async a=>{let b=new h;return await Promise.all(Object.entries(a||{}).map(([a,c])=>cj(b,a,c))),b},ci=a=>{if(ca(a))return!0;if(Array.isArray(a))return a.some(ci);if(a&&"object"==typeof a){for(let b in a)if(ci(a[b]))return!0}return!1},cj=async(a,b,c)=>{if(void 0!==c){if(null==c)throw TypeError(`Received null for "${b}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof c||"number"==typeof c||"boolean"==typeof c)a.append(b,String(c));else if(ca(c)){let d=await cb(c);a.append(b,d)}else if(Array.isArray(c))await Promise.all(c.map(c=>cj(a,b+"[]",c)));else if("object"==typeof c)await Promise.all(Object.entries(c).map(([c,d])=>cj(a,`${b}[${c}]`,d)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${c} instead`)}};var ck=function(a,b,c,d,e){if("m"===d)throw TypeError("Private method is not writable");if("a"===d&&!e)throw TypeError("Private accessor was defined without a setter");if("function"==typeof b?a!==b||!e:!b.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===d?e.call(a,c):e?e.value=c:b.set(a,c),c},cl=function(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)};async function cm(a){let{response:b}=a;if(a.options.stream)return(cJ("response",b.status,b.url,b.headers,b.body),a.options.__streamClass)?a.options.__streamClass.fromSSEResponse(b,a.controller):b3.fromSSEResponse(b,a.controller);if(204===b.status)return null;if(a.options.__binaryResponse)return b;let c=b.headers.get("content-type"),d=c?.split(";")[0]?.trim();if(d?.includes("application/json")||d?.endsWith("+json")){let a=await b.json();return cJ("response",b.status,b.url,b.headers,a),cn(a,b)}let e=await b.text();return cJ("response",b.status,b.url,b.headers,e),e}function cn(a,b){return!a||"object"!=typeof a||Array.isArray(a)?a:Object.defineProperty(a,"_request_id",{value:b.headers.get("x-request-id"),enumerable:!1})}bL();class co extends Promise{constructor(a,b=cm){super(a=>{a(null)}),this.responsePromise=a,this.parseResponse=b}_thenUnwrap(a){return new co(this.responsePromise,async b=>cn(a(await this.parseResponse(b),b),b.response))}asResponse(){return this.responsePromise.then(a=>a.response)}async withResponse(){let[a,b]=await Promise.all([this.parse(),this.asResponse()]);return{data:a,response:b,request_id:b.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(a,b){return this.parse().then(a,b)}catch(a){return this.parse().catch(a)}finally(a){return this.parse().finally(a)}}class cp{constructor({baseURL:a,maxRetries:b=2,timeout:c=6e5,httpAgent:d,fetch:e}){this.baseURL=a,this.maxRetries=cC("maxRetries",b),this.timeout=cC("timeout",c),this.httpAgent=d,this.fetch=e??g}authHeaders(a){return{}}defaultHeaders(a){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...cx(),...this.authHeaders(a)}}validateHeaders(a,b){}defaultIdempotencyKey(){return`stainless-node-retry-${cK()}`}get(a,b){return this.methodRequest("get",a,b)}post(a,b){return this.methodRequest("post",a,b)}patch(a,b){return this.methodRequest("patch",a,b)}put(a,b){return this.methodRequest("put",a,b)}delete(a,b){return this.methodRequest("delete",a,b)}methodRequest(a,b,c){return this.request(Promise.resolve(c).then(async c=>{let d=c&&b9(c?.body)?new DataView(await c.body.arrayBuffer()):c?.body instanceof DataView?c.body:c?.body instanceof ArrayBuffer?new DataView(c.body):c&&ArrayBuffer.isView(c?.body)?new DataView(c.body.buffer):c?.body;return{method:a,path:b,...c,body:d}}))}getAPIList(a,b,c){return this.requestAPIList(b,{method:"get",path:a,...c})}calculateContentLength(a){if("string"==typeof a){if("undefined"!=typeof Buffer)return Buffer.byteLength(a,"utf8").toString();if("undefined"!=typeof TextEncoder)return new TextEncoder().encode(a).length.toString()}else if(ArrayBuffer.isView(a))return a.byteLength.toString();return null}buildRequest(a,{retryCount:b=0}={}){let c={...a},{method:d,path:e,query:f,headers:g={}}=c,h=ArrayBuffer.isView(c.body)||c.__binaryRequest&&"string"==typeof c.body?c.body:cf(c.body)?c.body.body:c.body?JSON.stringify(c.body,null,2):null,i=this.calculateContentLength(h),j=this.buildURL(e,f);"timeout"in c&&cC("timeout",c.timeout),c.timeout=c.timeout??this.timeout;let k=c.httpAgent??this.httpAgent??l(j),m=c.timeout+1e3;"number"==typeof k?.options?.timeout&&m>(k.options.timeout??0)&&(k.options.timeout=m),this.idempotencyHeader&&"get"!==d&&(a.idempotencyKey||(a.idempotencyKey=this.defaultIdempotencyKey()),g[this.idempotencyHeader]=a.idempotencyKey);let n=this.buildHeaders({options:c,headers:g,contentLength:i,retryCount:b});return{req:{method:d,...h&&{body:h},headers:n,...k&&{agent:k},signal:c.signal??null},url:j,timeout:c.timeout}}buildHeaders({options:a,headers:b,contentLength:c,retryCount:d}){let e={};c&&(e["content-length"]=c);let g=this.defaultHeaders(a);return cH(e,g),cH(e,b),cf(a.body)&&"node"!==f&&delete e["content-type"],void 0===cL(g,"x-stainless-retry-count")&&void 0===cL(b,"x-stainless-retry-count")&&(e["x-stainless-retry-count"]=String(d)),void 0===cL(g,"x-stainless-timeout")&&void 0===cL(b,"x-stainless-timeout")&&a.timeout&&(e["x-stainless-timeout"]=String(Math.trunc(a.timeout/1e3))),this.validateHeaders(e,b),e}async prepareOptions(a){}async prepareRequest(a,{url:b,options:c}){}parseHeaders(a){return a?Symbol.iterator in a?Object.fromEntries(Array.from(a).map(a=>[...a])):{...a}:{}}makeStatusError(a,b,c,d){return bN.generate(a,b,c,d)}request(a,b=null){return new co(this.makeRequest(a,b))}async makeRequest(a,b){let c=await a,d=c.maxRetries??this.maxRetries;null==b&&(b=d),await this.prepareOptions(c);let{req:e,url:f,timeout:g}=this.buildRequest(c,{retryCount:d-b});if(await this.prepareRequest(e,{url:f,options:c}),cJ("request",f,c,e.headers),c.signal?.aborted)throw new bO;let h=new AbortController,i=await this.fetchWithTimeout(f,e,g,h).catch(cD);if(i instanceof Error){if(c.signal?.aborted)throw new bO;if(b)return this.retryRequest(c,b);if("AbortError"===i.name)throw new bQ;throw new bP({cause:i})}let j=cs(i.headers);if(!i.ok){if(b&&this.shouldRetry(i)){let a=`retrying, ${b} attempts remaining`;return cJ(`response (error; ${a})`,i.status,f,j),this.retryRequest(c,b,j)}let a=await i.text().catch(a=>cD(a).message),d=cy(a),e=d?void 0:a,g=b?"(error; no more retries left)":"(error; not retryable)";throw cJ(`response (error; ${g})`,i.status,f,j,e),this.makeStatusError(i.status,d,e,j)}return{response:i,options:c,controller:h}}requestAPIList(a,b){return new cr(this,this.makeRequest(b,null),a)}buildURL(a,b){let c=new URL(cA(a)?a:this.baseURL+(this.baseURL.endsWith("/")&&a.startsWith("/")?a.slice(1):a)),d=this.defaultQuery();return cF(d)||(b={...d,...b}),"object"==typeof b&&b&&!Array.isArray(b)&&(c.search=this.stringifyQuery(b)),c.toString()}stringifyQuery(a){return Object.entries(a).filter(([a,b])=>void 0!==b).map(([a,b])=>{if("string"==typeof b||"number"==typeof b||"boolean"==typeof b)return`${encodeURIComponent(a)}=${encodeURIComponent(b)}`;if(null===b)return`${encodeURIComponent(a)}=`;throw new bM(`Cannot stringify type ${typeof b}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(a,b,c,d){let{signal:e,...f}=b||{};e&&e.addEventListener("abort",()=>d.abort());let g=setTimeout(()=>d.abort(),c),h={signal:d.signal,...f};return h.method&&(h.method=h.method.toUpperCase()),this.fetch.call(void 0,a,h).finally(()=>{clearTimeout(g)})}shouldRetry(a){let b=a.headers.get("x-should-retry");return"true"===b||"false"!==b&&(408===a.status||409===a.status||429===a.status||!!(a.status>=500))}async retryRequest(a,b,c){let d,e=c?.["retry-after-ms"];if(e){let a=parseFloat(e);Number.isNaN(a)||(d=a)}let f=c?.["retry-after"];if(f&&!d){let a=parseFloat(f);d=Number.isNaN(a)?Date.parse(f)-Date.now():1e3*a}if(!(d&&0<=d&&d<6e4)){let c=a.maxRetries??this.maxRetries;d=this.calculateDefaultRetryTimeoutMillis(b,c)}return await cB(d),this.makeRequest(a,b-1)}calculateDefaultRetryTimeoutMillis(a,b){return Math.min(.5*Math.pow(2,b-a),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${B}`}}class cq{constructor(a,b,c,d){E.set(this,void 0),ck(this,E,a,"f"),this.options=d,this.response=b,this.body=c}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageInfo()}async getNextPage(){let a=this.nextPageInfo();if(!a)throw new bM("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let b={...this.options};if("params"in a&&"object"==typeof b.query)b.query={...b.query,...a.params};else if("url"in a){for(let[c,d]of[...Object.entries(b.query||{}),...a.url.searchParams.entries()])a.url.searchParams.set(c,d);b.query=void 0,b.path=a.url.toString()}return await cl(this,E,"f").requestAPIList(this.constructor,b)}async *iterPages(){let a=this;for(yield a;a.hasNextPage();)a=await a.getNextPage(),yield a}async *[(E=new WeakMap,Symbol.asyncIterator)](){for await(let a of this.iterPages())for(let b of a.getPaginatedItems())yield b}}class cr extends co{constructor(a,b,c){super(b,async b=>new c(a,b.response,await cm(b),b.options))}async *[Symbol.asyncIterator](){for await(let a of(await this))yield a}}let cs=a=>new Proxy(Object.fromEntries(a.entries()),{get(a,b){let c=b.toString();return a[c.toLowerCase()]||a[c]}}),ct={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},cu=a=>"object"==typeof a&&null!==a&&!cF(a)&&Object.keys(a).every(a=>cG(ct,a)),cv=a=>"x32"===a?"x32":"x86_64"===a||"x64"===a?"x64":"arm"===a?"arm":"aarch64"===a||"arm64"===a?"arm64":a?`other:${a}`:"unknown",cw=a=>(a=a.toLowerCase()).includes("ios")?"iOS":"android"===a?"Android":"darwin"===a?"MacOS":"win32"===a?"Windows":"freebsd"===a?"FreeBSD":"openbsd"===a?"OpenBSD":"linux"===a?"Linux":a?`Other:${a}`:"Unknown",cx=()=>e??(e=(()=>{if("undefined"!=typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":B,"X-Stainless-OS":cw(Deno.build.os),"X-Stainless-Arch":cv(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":B,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if("[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":B,"X-Stainless-OS":cw(process.platform),"X-Stainless-Arch":cv(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let a=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:a,pattern:b}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let c=b.exec(navigator.userAgent);if(c){let b=c[1]||0,d=c[2]||0,e=c[3]||0;return{browser:a,version:`${b}.${d}.${e}`}}}return null}();return a?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":B,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${a.browser}`,"X-Stainless-Runtime-Version":a.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":B,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),cy=a=>{try{return JSON.parse(a)}catch(a){return}},cz=/^[a-z][a-z0-9+.-]*:/i,cA=a=>cz.test(a),cB=a=>new Promise(b=>setTimeout(b,a)),cC=(a,b)=>{if("number"!=typeof b||!Number.isInteger(b))throw new bM(`${a} must be an integer`);if(b<0)throw new bM(`${a} must be a positive integer`);return b},cD=a=>{if(a instanceof Error)return a;if("object"==typeof a&&null!==a)try{return Error(JSON.stringify(a))}catch{}return Error(a)},cE=a=>"undefined"!=typeof process?process.env?.[a]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(a)?.trim():void 0;function cF(a){if(!a)return!0;for(let b in a)return!1;return!0}function cG(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function cH(a,b){for(let c in b){if(!cG(b,c))continue;let d=c.toLowerCase();if(!d)continue;let e=b[c];null===e?delete a[d]:void 0!==e&&(a[d]=e)}}let cI=new Set(["authorization","api-key"]);function cJ(a,...b){"undefined"!=typeof process&&process?.env?.DEBUG==="true"&&console.log(`OpenAI:DEBUG:${a}`,...b.map(a=>{if(!a)return a;if(a.headers){let b={...a,headers:{...a.headers}};for(let c in a.headers)cI.has(c.toLowerCase())&&(b.headers[c]="REDACTED");return b}let b=null;for(let c in a)cI.has(c.toLowerCase())&&(b??(b={...a}),b[c]="REDACTED");return b??a}))}let cK=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,a=>{let b=16*Math.random()|0;return("x"===a?b:3&b|8).toString(16)}),cL=(a,b)=>{let c=b.toLowerCase();if("function"==typeof a?.get){let d=b[0]?.toUpperCase()+b.substring(1).replace(/([^\w])(\w)/g,(a,b,c)=>b+c.toUpperCase());for(let e of[b,c,b.toUpperCase(),d]){let b=a.get(e);if(b)return b}}for(let[d,e]of Object.entries(a))if(d.toLowerCase()===c){if(Array.isArray(e)){if(e.length<=1)return e[0];return console.warn(`Received ${e.length} entries for the ${b} header, using the first entry.`),e[0]}return e}};function cM(a){return null!=a&&"object"==typeof a&&!Array.isArray(a)}class cN{constructor(a){this._client=a}}class cO extends cN{create(a,b){return this._client.post("/completions",{body:a,...b,stream:a.stream??!1})}}class cP extends cN{list(a,b={},c){return cu(b)?this.list(a,{},b):this._client.getAPIList(`/chat/completions/${a}/messages`,cU,{query:b,...c})}}class cQ extends cq{constructor(a,b,c,d){super(a,b,c,d),this.data=c.data||[],this.object=c.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class cR extends cq{constructor(a,b,c,d){super(a,b,c,d),this.data=c.data||[],this.has_more=c.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageParams(){let a=this.nextPageInfo();if(!a)return null;if("params"in a)return a.params;let b=Object.fromEntries(a.url.searchParams);return Object.keys(b).length?b:null}nextPageInfo(){let a=this.getPaginatedItems();if(!a.length)return null;let b=a[a.length-1]?.id;return b?{params:{after:b}}:null}}class cS extends cN{constructor(){super(...arguments),this.messages=new cP(this._client)}create(a,b){return this._client.post("/chat/completions",{body:a,...b,stream:a.stream??!1})}retrieve(a,b){return this._client.get(`/chat/completions/${a}`,b)}update(a,b,c){return this._client.post(`/chat/completions/${a}`,{body:b,...c})}list(a={},b){return cu(a)?this.list({},a):this._client.getAPIList("/chat/completions",cT,{query:a,...b})}del(a,b){return this._client.delete(`/chat/completions/${a}`,b)}}class cT extends cR{}class cU extends cR{}cS.ChatCompletionsPage=cT,cS.Messages=cP;class cV extends cN{constructor(){super(...arguments),this.completions=new cS(this._client)}}cV.Completions=cS,cV.ChatCompletionsPage=cT;class cW extends cN{create(a,b){let c=!!a.encoding_format,d=c?a.encoding_format:"base64";c&&cJ("Request","User defined encoding_format:",a.encoding_format);let e=this._client.post("/embeddings",{body:{...a,encoding_format:d},...b});return c?e:(cJ("response","Decoding base64 embeddings to float32 array"),e._thenUnwrap(a=>(a&&a.data&&a.data.forEach(a=>{let b=a.embedding;a.embedding=(a=>{if("undefined"!=typeof Buffer){let b=Buffer.from(a,"base64");return Array.from(new Float32Array(b.buffer,b.byteOffset,b.length/Float32Array.BYTES_PER_ELEMENT))}{let b=atob(a),c=b.length,d=new Uint8Array(c);for(let a=0;a<c;a++)d[a]=b.charCodeAt(a);return Array.from(new Float32Array(d.buffer))}})(b)}),a)))}}class cX extends cN{create(a,b){return this._client.post("/files",cg({body:a,...b}))}retrieve(a,b){return this._client.get(`/files/${a}`,b)}list(a={},b){return cu(a)?this.list({},a):this._client.getAPIList("/files",cY,{query:a,...b})}del(a,b){return this._client.delete(`/files/${a}`,b)}content(a,b){return this._client.get(`/files/${a}/content`,{...b,headers:{Accept:"application/binary",...b?.headers},__binaryResponse:!0})}retrieveContent(a,b){return this._client.get(`/files/${a}/content`,b)}async waitForProcessing(a,{pollInterval:b=5e3,maxWait:c=18e5}={}){let d=new Set(["processed","error","deleted"]),e=Date.now(),f=await this.retrieve(a);for(;!f.status||!d.has(f.status);)if(await cB(b),f=await this.retrieve(a),Date.now()-e>c)throw new bQ({message:`Giving up on waiting for file ${a} to finish processing after ${c} milliseconds.`});return f}}class cY extends cR{}cX.FileObjectsPage=cY;class cZ extends cN{createVariation(a,b){return this._client.post("/images/variations",cg({body:a,...b}))}edit(a,b){return this._client.post("/images/edits",cg({body:a,...b}))}generate(a,b){return this._client.post("/images/generations",{body:a,...b})}}class c$ extends cN{create(a,b){return this._client.post("/audio/speech",{body:a,...b,headers:{Accept:"application/octet-stream",...b?.headers},__binaryResponse:!0})}}class c_ extends cN{create(a,b){return this._client.post("/audio/transcriptions",cg({body:a,...b,stream:a.stream??!1,__metadata:{model:a.model}}))}}class c0 extends cN{create(a,b){return this._client.post("/audio/translations",cg({body:a,...b,__metadata:{model:a.model}}))}}class c1 extends cN{constructor(){super(...arguments),this.transcriptions=new c_(this._client),this.translations=new c0(this._client),this.speech=new c$(this._client)}}c1.Transcriptions=c_,c1.Translations=c0,c1.Speech=c$;class c2 extends cN{create(a,b){return this._client.post("/moderations",{body:a,...b})}}class c3 extends cN{retrieve(a,b){return this._client.get(`/models/${a}`,b)}list(a){return this._client.getAPIList("/models",c4,a)}del(a,b){return this._client.delete(`/models/${a}`,b)}}class c4 extends cQ{}c3.ModelsPage=c4;class c5 extends cN{}class c6 extends cN{run(a,b){return this._client.post("/fine_tuning/alpha/graders/run",{body:a,...b})}validate(a,b){return this._client.post("/fine_tuning/alpha/graders/validate",{body:a,...b})}}class c7 extends cN{constructor(){super(...arguments),this.graders=new c6(this._client)}}c7.Graders=c6;class c8 extends cN{create(a,b,c){return this._client.getAPIList(`/fine_tuning/checkpoints/${a}/permissions`,c9,{body:b,method:"post",...c})}retrieve(a,b={},c){return cu(b)?this.retrieve(a,{},b):this._client.get(`/fine_tuning/checkpoints/${a}/permissions`,{query:b,...c})}del(a,b,c){return this._client.delete(`/fine_tuning/checkpoints/${a}/permissions/${b}`,c)}}class c9 extends cQ{}c8.PermissionCreateResponsesPage=c9;class da extends cN{constructor(){super(...arguments),this.permissions=new c8(this._client)}}da.Permissions=c8,da.PermissionCreateResponsesPage=c9;class db extends cN{list(a,b={},c){return cu(b)?this.list(a,{},b):this._client.getAPIList(`/fine_tuning/jobs/${a}/checkpoints`,dc,{query:b,...c})}}class dc extends cR{}db.FineTuningJobCheckpointsPage=dc;class dd extends cN{constructor(){super(...arguments),this.checkpoints=new db(this._client)}create(a,b){return this._client.post("/fine_tuning/jobs",{body:a,...b})}retrieve(a,b){return this._client.get(`/fine_tuning/jobs/${a}`,b)}list(a={},b){return cu(a)?this.list({},a):this._client.getAPIList("/fine_tuning/jobs",de,{query:a,...b})}cancel(a,b){return this._client.post(`/fine_tuning/jobs/${a}/cancel`,b)}listEvents(a,b={},c){return cu(b)?this.listEvents(a,{},b):this._client.getAPIList(`/fine_tuning/jobs/${a}/events`,df,{query:b,...c})}pause(a,b){return this._client.post(`/fine_tuning/jobs/${a}/pause`,b)}resume(a,b){return this._client.post(`/fine_tuning/jobs/${a}/resume`,b)}}class de extends cR{}class df extends cR{}dd.FineTuningJobsPage=de,dd.FineTuningJobEventsPage=df,dd.Checkpoints=db,dd.FineTuningJobCheckpointsPage=dc;class dg extends cN{constructor(){super(...arguments),this.methods=new c5(this._client),this.jobs=new dd(this._client),this.checkpoints=new da(this._client),this.alpha=new c7(this._client)}}dg.Methods=c5,dg.Jobs=dd,dg.FineTuningJobsPage=de,dg.FineTuningJobEventsPage=df,dg.Checkpoints=da,dg.Alpha=c7;class dh extends cN{}class di extends cN{constructor(){super(...arguments),this.graderModels=new dh(this._client)}}di.GraderModels=dh;let dj=async a=>{let b=await Promise.allSettled(a),c=b.filter(a=>"rejected"===a.status);if(c.length){for(let a of c)console.error(a.reason);throw Error(`${c.length} promise(s) failed - see the above errors`)}let d=[];for(let a of b)"fulfilled"===a.status&&d.push(a.value);return d};class dk extends cN{create(a,b,c){return this._client.post(`/vector_stores/${a}/files`,{body:b,...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}retrieve(a,b,c){return this._client.get(`/vector_stores/${a}/files/${b}`,{...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}update(a,b,c,d){return this._client.post(`/vector_stores/${a}/files/${b}`,{body:c,...d,headers:{"OpenAI-Beta":"assistants=v2",...d?.headers}})}list(a,b={},c){return cu(b)?this.list(a,{},b):this._client.getAPIList(`/vector_stores/${a}/files`,dl,{query:b,...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}del(a,b,c){return this._client.delete(`/vector_stores/${a}/files/${b}`,{...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}async createAndPoll(a,b,c){let d=await this.create(a,b,c);return await this.poll(a,d.id,c)}async poll(a,b,c){let d={...c?.headers,"X-Stainless-Poll-Helper":"true"};for(c?.pollIntervalMs&&(d["X-Stainless-Custom-Poll-Interval"]=c.pollIntervalMs.toString());;){let e=await this.retrieve(a,b,{...c,headers:d}).withResponse(),f=e.data;switch(f.status){case"in_progress":let g=5e3;if(c?.pollIntervalMs)g=c.pollIntervalMs;else{let a=e.response.headers.get("openai-poll-after-ms");if(a){let b=parseInt(a);isNaN(b)||(g=b)}}await cB(g);break;case"failed":case"completed":return f}}}async upload(a,b,c){let d=await this._client.files.create({file:b,purpose:"assistants"},c);return this.create(a,{file_id:d.id},c)}async uploadAndPoll(a,b,c){let d=await this.upload(a,b,c);return await this.poll(a,d.id,c)}content(a,b,c){return this._client.getAPIList(`/vector_stores/${a}/files/${b}/content`,dm,{...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}}class dl extends cR{}class dm extends cQ{}dk.VectorStoreFilesPage=dl,dk.FileContentResponsesPage=dm;class dn extends cN{create(a,b,c){return this._client.post(`/vector_stores/${a}/file_batches`,{body:b,...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}retrieve(a,b,c){return this._client.get(`/vector_stores/${a}/file_batches/${b}`,{...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}cancel(a,b,c){return this._client.post(`/vector_stores/${a}/file_batches/${b}/cancel`,{...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}async createAndPoll(a,b,c){let d=await this.create(a,b);return await this.poll(a,d.id,c)}listFiles(a,b,c={},d){return cu(c)?this.listFiles(a,b,{},c):this._client.getAPIList(`/vector_stores/${a}/file_batches/${b}/files`,dl,{query:c,...d,headers:{"OpenAI-Beta":"assistants=v2",...d?.headers}})}async poll(a,b,c){let d={...c?.headers,"X-Stainless-Poll-Helper":"true"};for(c?.pollIntervalMs&&(d["X-Stainless-Custom-Poll-Interval"]=c.pollIntervalMs.toString());;){let{data:e,response:f}=await this.retrieve(a,b,{...c,headers:d}).withResponse();switch(e.status){case"in_progress":let g=5e3;if(c?.pollIntervalMs)g=c.pollIntervalMs;else{let a=f.headers.get("openai-poll-after-ms");if(a){let b=parseInt(a);isNaN(b)||(g=b)}}await cB(g);break;case"failed":case"cancelled":case"completed":return e}}}async uploadAndPoll(a,{files:b,fileIds:c=[]},d){if(null==b||0==b.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let e=Math.min(d?.maxConcurrency??5,b.length),f=this._client,g=b.values(),h=[...c];async function i(a){for(let b of a){let a=await f.files.create({file:b,purpose:"assistants"},d);h.push(a.id)}}let j=Array(e).fill(g).map(i);return await dj(j),await this.createAndPoll(a,{file_ids:h})}}class dp extends cN{constructor(){super(...arguments),this.files=new dk(this._client),this.fileBatches=new dn(this._client)}create(a,b){return this._client.post("/vector_stores",{body:a,...b,headers:{"OpenAI-Beta":"assistants=v2",...b?.headers}})}retrieve(a,b){return this._client.get(`/vector_stores/${a}`,{...b,headers:{"OpenAI-Beta":"assistants=v2",...b?.headers}})}update(a,b,c){return this._client.post(`/vector_stores/${a}`,{body:b,...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}list(a={},b){return cu(a)?this.list({},a):this._client.getAPIList("/vector_stores",dq,{query:a,...b,headers:{"OpenAI-Beta":"assistants=v2",...b?.headers}})}del(a,b){return this._client.delete(`/vector_stores/${a}`,{...b,headers:{"OpenAI-Beta":"assistants=v2",...b?.headers}})}search(a,b,c){return this._client.getAPIList(`/vector_stores/${a}/search`,dr,{body:b,method:"post",...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}}class dq extends cR{}class dr extends cQ{}dp.VectorStoresPage=dq,dp.VectorStoreSearchResponsesPage=dr,dp.Files=dk,dp.VectorStoreFilesPage=dl,dp.FileContentResponsesPage=dm,dp.FileBatches=dn;class ds extends cN{create(a,b){return this._client.post("/assistants",{body:a,...b,headers:{"OpenAI-Beta":"assistants=v2",...b?.headers}})}retrieve(a,b){return this._client.get(`/assistants/${a}`,{...b,headers:{"OpenAI-Beta":"assistants=v2",...b?.headers}})}update(a,b,c){return this._client.post(`/assistants/${a}`,{body:b,...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}list(a={},b){return cu(a)?this.list({},a):this._client.getAPIList("/assistants",dt,{query:a,...b,headers:{"OpenAI-Beta":"assistants=v2",...b?.headers}})}del(a,b){return this._client.delete(`/assistants/${a}`,{...b,headers:{"OpenAI-Beta":"assistants=v2",...b?.headers}})}}class dt extends cR{}function du(a){return"function"==typeof a.parse}ds.AssistantsPage=dt;let dv=a=>a?.role==="assistant",dw=a=>a?.role==="function",dx=a=>a?.role==="tool";var dy=function(a,b,c,d,e){if("m"===d)throw TypeError("Private method is not writable");if("a"===d&&!e)throw TypeError("Private accessor was defined without a setter");if("function"==typeof b?a!==b||!e:!b.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===d?e.call(a,c):e?e.value=c:b.set(a,c),c},dz=function(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)};class dA{constructor(){F.add(this),this.controller=new AbortController,G.set(this,void 0),H.set(this,()=>{}),I.set(this,()=>{}),J.set(this,void 0),K.set(this,()=>{}),L.set(this,()=>{}),M.set(this,{}),N.set(this,!1),O.set(this,!1),P.set(this,!1),Q.set(this,!1),dy(this,G,new Promise((a,b)=>{dy(this,H,a,"f"),dy(this,I,b,"f")}),"f"),dy(this,J,new Promise((a,b)=>{dy(this,K,a,"f"),dy(this,L,b,"f")}),"f"),dz(this,G,"f").catch(()=>{}),dz(this,J,"f").catch(()=>{})}_run(a){setTimeout(()=>{a().then(()=>{this._emitFinal(),this._emit("end")},dz(this,F,"m",R).bind(this))},0)}_connected(){this.ended||(dz(this,H,"f").call(this),this._emit("connect"))}get ended(){return dz(this,N,"f")}get errored(){return dz(this,O,"f")}get aborted(){return dz(this,P,"f")}abort(){this.controller.abort()}on(a,b){return(dz(this,M,"f")[a]||(dz(this,M,"f")[a]=[])).push({listener:b}),this}off(a,b){let c=dz(this,M,"f")[a];if(!c)return this;let d=c.findIndex(a=>a.listener===b);return d>=0&&c.splice(d,1),this}once(a,b){return(dz(this,M,"f")[a]||(dz(this,M,"f")[a]=[])).push({listener:b,once:!0}),this}emitted(a){return new Promise((b,c)=>{dy(this,Q,!0,"f"),"error"!==a&&this.once("error",c),this.once(a,b)})}async done(){dy(this,Q,!0,"f"),await dz(this,J,"f")}_emit(a,...b){if(dz(this,N,"f"))return;"end"===a&&(dy(this,N,!0,"f"),dz(this,K,"f").call(this));let c=dz(this,M,"f")[a];if(c&&(dz(this,M,"f")[a]=c.filter(a=>!a.once),c.forEach(({listener:a})=>a(...b))),"abort"===a){let a=b[0];dz(this,Q,"f")||c?.length||Promise.reject(a),dz(this,I,"f").call(this,a),dz(this,L,"f").call(this,a),this._emit("end");return}if("error"===a){let a=b[0];dz(this,Q,"f")||c?.length||Promise.reject(a),dz(this,I,"f").call(this,a),dz(this,L,"f").call(this,a),this._emit("end")}}_emitFinal(){}}function dB(a){return a?.$brand==="auto-parseable-response-format"}function dC(a){return a?.$brand==="auto-parseable-tool"}function dD(a,b){let c=a.choices.map(a=>{var c,d;if("length"===a.finish_reason)throw new bZ;if("content_filter"===a.finish_reason)throw new b$;return{...a,message:{...a.message,...a.message.tool_calls?{tool_calls:a.message.tool_calls?.map(a=>(function(a,b){let c=a.tools?.find(a=>a.function?.name===b.function.name);return{...b,function:{...b.function,parsed_arguments:dC(c)?c.$parseRaw(b.function.arguments):c?.function.strict?JSON.parse(b.function.arguments):null}}})(b,a))??void 0}:void 0,parsed:a.message.content&&!a.message.refusal?(c=b,d=a.message.content,c.response_format?.type!=="json_schema"?null:c.response_format?.type==="json_schema"?"$parseRaw"in c.response_format?c.response_format.$parseRaw(d):JSON.parse(d):null):null}}});return{...a,choices:c}}function dE(a){return!!dB(a.response_format)||(a.tools?.some(a=>dC(a)||"function"===a.type&&!0===a.function.strict)??!1)}G=new WeakMap,H=new WeakMap,I=new WeakMap,J=new WeakMap,K=new WeakMap,L=new WeakMap,M=new WeakMap,N=new WeakMap,O=new WeakMap,P=new WeakMap,Q=new WeakMap,F=new WeakSet,R=function(a){if(dy(this,O,!0,"f"),a instanceof Error&&"AbortError"===a.name&&(a=new bO),a instanceof bO)return dy(this,P,!0,"f"),this._emit("abort",a);if(a instanceof bM)return this._emit("error",a);if(a instanceof Error){let b=new bM(a.message);return b.cause=a,this._emit("error",b)}return this._emit("error",new bM(String(a)))};var dF=function(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)};class dG extends dA{constructor(){super(...arguments),S.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(a){this._chatCompletions.push(a),this._emit("chatCompletion",a);let b=a.choices[0]?.message;return b&&this._addMessage(b),a}_addMessage(a,b=!0){if("content"in a||(a.content=null),this.messages.push(a),b){if(this._emit("message",a),(dw(a)||dx(a))&&a.content)this._emit("functionCallResult",a.content);else if(dv(a)&&a.function_call)this._emit("functionCall",a.function_call);else if(dv(a)&&a.tool_calls)for(let b of a.tool_calls)"function"===b.type&&this._emit("functionCall",b.function)}}async finalChatCompletion(){await this.done();let a=this._chatCompletions[this._chatCompletions.length-1];if(!a)throw new bM("stream ended without producing a ChatCompletion");return a}async finalContent(){return await this.done(),dF(this,S,"m",T).call(this)}async finalMessage(){return await this.done(),dF(this,S,"m",U).call(this)}async finalFunctionCall(){return await this.done(),dF(this,S,"m",V).call(this)}async finalFunctionCallResult(){return await this.done(),dF(this,S,"m",W).call(this)}async totalUsage(){return await this.done(),dF(this,S,"m",X).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let a=this._chatCompletions[this._chatCompletions.length-1];a&&this._emit("finalChatCompletion",a);let b=dF(this,S,"m",U).call(this);b&&this._emit("finalMessage",b);let c=dF(this,S,"m",T).call(this);c&&this._emit("finalContent",c);let d=dF(this,S,"m",V).call(this);d&&this._emit("finalFunctionCall",d);let e=dF(this,S,"m",W).call(this);null!=e&&this._emit("finalFunctionCallResult",e),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",dF(this,S,"m",X).call(this))}async _createChatCompletion(a,b,c){let d=c?.signal;d&&(d.aborted&&this.controller.abort(),d.addEventListener("abort",()=>this.controller.abort())),dF(this,S,"m",Y).call(this,b);let e=await a.chat.completions.create({...b,stream:!1},{...c,signal:this.controller.signal});return this._connected(),this._addChatCompletion(dD(e,b))}async _runChatCompletion(a,b,c){for(let a of b.messages)this._addMessage(a,!1);return await this._createChatCompletion(a,b,c)}async _runFunctions(a,b,c){let d="function",{function_call:e="auto",stream:f,...g}=b,h="string"!=typeof e&&e?.name,{maxChatCompletions:i=10}=c||{},j={};for(let a of b.functions)j[a.name||a.function.name]=a;let k=b.functions.map(a=>({name:a.name||a.function.name,parameters:a.parameters,description:a.description}));for(let a of b.messages)this._addMessage(a,!1);for(let b=0;b<i;++b){let b,f=await this._createChatCompletion(a,{...g,function_call:e,functions:k,messages:[...this.messages]},c),i=f.choices[0]?.message;if(!i)throw new bM("missing message in ChatCompletion response");if(!i.function_call)return;let{name:l,arguments:m}=i.function_call,n=j[l];if(n){if(h&&h!==l){let a=`Invalid function_call: ${JSON.stringify(l)}. ${JSON.stringify(h)} requested. Please try again`;this._addMessage({role:d,name:l,content:a});continue}}else{let a=`Invalid function_call: ${JSON.stringify(l)}. Available options are: ${k.map(a=>JSON.stringify(a.name)).join(", ")}. Please try again`;this._addMessage({role:d,name:l,content:a});continue}try{b=du(n)?await n.parse(m):m}catch(a){this._addMessage({role:d,name:l,content:a instanceof Error?a.message:String(a)});continue}let o=await n.function(b,this),p=dF(this,S,"m",Z).call(this,o);if(this._addMessage({role:d,name:l,content:p}),h)return}}async _runTools(a,b,c){let d="tool",{tool_choice:e="auto",stream:f,...g}=b,h="string"!=typeof e&&e?.function?.name,{maxChatCompletions:i=10}=c||{},j=b.tools.map(a=>{if(dC(a)){if(!a.$callback)throw new bM("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:a.$callback,name:a.function.name,description:a.function.description||"",parameters:a.function.parameters,parse:a.$parseRaw,strict:!0}}}return a}),k={};for(let a of j)"function"===a.type&&(k[a.function.name||a.function.function.name]=a.function);let l="tools"in b?j.map(a=>"function"===a.type?{type:"function",function:{name:a.function.name||a.function.function.name,parameters:a.function.parameters,description:a.function.description,strict:a.function.strict}}:a):void 0;for(let a of b.messages)this._addMessage(a,!1);for(let b=0;b<i;++b){let b=await this._createChatCompletion(a,{...g,tool_choice:e,tools:l,messages:[...this.messages]},c),f=b.choices[0]?.message;if(!f)throw new bM("missing message in ChatCompletion response");if(!f.tool_calls?.length)break;for(let a of f.tool_calls){let b;if("function"!==a.type)continue;let c=a.id,{name:e,arguments:f}=a.function,g=k[e];if(g){if(h&&h!==e){let a=`Invalid tool_call: ${JSON.stringify(e)}. ${JSON.stringify(h)} requested. Please try again`;this._addMessage({role:d,tool_call_id:c,content:a});continue}}else{let a=`Invalid tool_call: ${JSON.stringify(e)}. Available options are: ${Object.keys(k).map(a=>JSON.stringify(a)).join(", ")}. Please try again`;this._addMessage({role:d,tool_call_id:c,content:a});continue}try{b=du(g)?await g.parse(f):f}catch(b){let a=b instanceof Error?b.message:String(b);this._addMessage({role:d,tool_call_id:c,content:a});continue}let i=await g.function(b,this),j=dF(this,S,"m",Z).call(this,i);if(this._addMessage({role:d,tool_call_id:c,content:j}),h)return}}}}S=new WeakSet,T=function(){return dF(this,S,"m",U).call(this).content??null},U=function(){let a=this.messages.length;for(;a-- >0;){let b=this.messages[a];if(dv(b)){let{function_call:a,...c}=b,d={...c,content:b.content??null,refusal:b.refusal??null};return a&&(d.function_call=a),d}}throw new bM("stream ended without producing a ChatCompletionMessage with role=assistant")},V=function(){for(let a=this.messages.length-1;a>=0;a--){let b=this.messages[a];if(dv(b)&&b?.function_call)return b.function_call;if(dv(b)&&b?.tool_calls?.length)return b.tool_calls.at(-1)?.function}},W=function(){for(let a=this.messages.length-1;a>=0;a--){let b=this.messages[a];if(dw(b)&&null!=b.content||dx(b)&&null!=b.content&&"string"==typeof b.content&&this.messages.some(a=>"assistant"===a.role&&a.tool_calls?.some(a=>"function"===a.type&&a.id===b.tool_call_id)))return b.content}},X=function(){let a={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:b}of this._chatCompletions)b&&(a.completion_tokens+=b.completion_tokens,a.prompt_tokens+=b.prompt_tokens,a.total_tokens+=b.total_tokens);return a},Y=function(a){if(null!=a.n&&a.n>1)throw new bM("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Z=function(a){return"string"==typeof a?a:void 0===a?"undefined":JSON.stringify(a)};class dH extends dG{static runFunctions(a,b,c){let d=new dH,e={...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return d._run(()=>d._runFunctions(a,b,e)),d}static runTools(a,b,c){let d=new dH,e={...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"runTools"}};return d._run(()=>d._runTools(a,b,e)),d}_addMessage(a,b=!0){super._addMessage(a,b),dv(a)&&a.content&&this._emit("content",a.content)}}let dI={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,ALL:511};class dJ extends Error{}class dK extends Error{}let dL=a=>(function(a,b=dI.ALL){if("string"!=typeof a)throw TypeError(`expecting str, got ${typeof a}`);if(!a.trim())throw Error(`${a} is empty`);return((a,b)=>{let c=a.length,d=0,e=a=>{throw new dJ(`${a} at position ${d}`)},f=a=>{throw new dK(`${a} at position ${d}`)},g=()=>(l(),d>=c&&e("Unexpected end of input"),'"'===a[d])?h():"{"===a[d]?i():"["===a[d]?j():"null"===a.substring(d,d+4)||dI.NULL&b&&c-d<4&&"null".startsWith(a.substring(d))?(d+=4,null):"true"===a.substring(d,d+4)||dI.BOOL&b&&c-d<4&&"true".startsWith(a.substring(d))?(d+=4,!0):"false"===a.substring(d,d+5)||dI.BOOL&b&&c-d<5&&"false".startsWith(a.substring(d))?(d+=5,!1):"Infinity"===a.substring(d,d+8)||dI.INFINITY&b&&c-d<8&&"Infinity".startsWith(a.substring(d))?(d+=8,1/0):"-Infinity"===a.substring(d,d+9)||dI.MINUS_INFINITY&b&&1<c-d&&c-d<9&&"-Infinity".startsWith(a.substring(d))?(d+=9,-1/0):"NaN"===a.substring(d,d+3)||dI.NAN&b&&c-d<3&&"NaN".startsWith(a.substring(d))?(d+=3,NaN):k(),h=()=>{let g=d,h=!1;for(d++;d<c&&('"'!==a[d]||h&&"\\"===a[d-1]);)h="\\"===a[d]&&!h,d++;if('"'==a.charAt(d))try{return JSON.parse(a.substring(g,++d-Number(h)))}catch(a){f(String(a))}else if(dI.STR&b)try{return JSON.parse(a.substring(g,d-Number(h))+'"')}catch(b){return JSON.parse(a.substring(g,a.lastIndexOf("\\"))+'"')}e("Unterminated string literal")},i=()=>{d++,l();let f={};try{for(;"}"!==a[d];){if(l(),d>=c&&dI.OBJ&b)return f;let e=h();l(),d++;try{let a=g();Object.defineProperty(f,e,{value:a,writable:!0,enumerable:!0,configurable:!0})}catch(a){if(dI.OBJ&b)return f;throw a}l(),","===a[d]&&d++}}catch(a){if(dI.OBJ&b)return f;e("Expected '}' at end of object")}return d++,f},j=()=>{d++;let c=[];try{for(;"]"!==a[d];)c.push(g()),l(),","===a[d]&&d++}catch(a){if(dI.ARR&b)return c;e("Expected ']' at end of array")}return d++,c},k=()=>{if(0===d){"-"===a&&dI.NUM&b&&e("Not sure what '-' is");try{return JSON.parse(a)}catch(c){if(dI.NUM&b)try{if("."===a[a.length-1])return JSON.parse(a.substring(0,a.lastIndexOf(".")));return JSON.parse(a.substring(0,a.lastIndexOf("e")))}catch(a){}f(String(c))}}let g=d;for("-"===a[d]&&d++;a[d]&&!",]}".includes(a[d]);)d++;d!=c||dI.NUM&b||e("Unterminated number literal");try{return JSON.parse(a.substring(g,d))}catch(c){"-"===a.substring(g,d)&&dI.NUM&b&&e("Not sure what '-' is");try{return JSON.parse(a.substring(g,a.lastIndexOf("e")))}catch(a){f(String(a))}}},l=()=>{for(;d<c&&" \n\r	".includes(a[d]);)d++};return g()})(a.trim(),b)})(a,dI.ALL^dI.NUM);var dM=function(a,b,c,d,e){if("m"===d)throw TypeError("Private method is not writable");if("a"===d&&!e)throw TypeError("Private accessor was defined without a setter");if("function"==typeof b?a!==b||!e:!b.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===d?e.call(a,c):e?e.value=c:b.set(a,c),c},dN=function(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)};class dO extends dG{constructor(a){super(),$.add(this),_.set(this,void 0),aa.set(this,void 0),ab.set(this,void 0),dM(this,_,a,"f"),dM(this,aa,[],"f")}get currentChatCompletionSnapshot(){return dN(this,ab,"f")}static fromReadableStream(a){let b=new dO(null);return b._run(()=>b._fromReadableStream(a)),b}static createChatCompletion(a,b,c){let d=new dO(b);return d._run(()=>d._runChatCompletion(a,{...b,stream:!0},{...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"stream"}})),d}async _createChatCompletion(a,b,c){super._createChatCompletion;let d=c?.signal;d&&(d.aborted&&this.controller.abort(),d.addEventListener("abort",()=>this.controller.abort())),dN(this,$,"m",ac).call(this);let e=await a.chat.completions.create({...b,stream:!0},{...c,signal:this.controller.signal});for await(let a of(this._connected(),e))dN(this,$,"m",ae).call(this,a);if(e.controller.signal?.aborted)throw new bO;return this._addChatCompletion(dN(this,$,"m",ah).call(this))}async _fromReadableStream(a,b){let c,d=b?.signal;d&&(d.aborted&&this.controller.abort(),d.addEventListener("abort",()=>this.controller.abort())),dN(this,$,"m",ac).call(this),this._connected();let e=b3.fromReadableStream(a,this.controller);for await(let a of e)c&&c!==a.id&&this._addChatCompletion(dN(this,$,"m",ah).call(this)),dN(this,$,"m",ae).call(this,a),c=a.id;if(e.controller.signal?.aborted)throw new bO;return this._addChatCompletion(dN(this,$,"m",ah).call(this))}[(_=new WeakMap,aa=new WeakMap,ab=new WeakMap,$=new WeakSet,ac=function(){this.ended||dM(this,ab,void 0,"f")},ad=function(a){let b=dN(this,aa,"f")[a.index];return b||(b={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},dN(this,aa,"f")[a.index]=b),b},ae=function(a){if(this.ended)return;let b=dN(this,$,"m",aj).call(this,a);for(let c of(this._emit("chunk",a,b),a.choices)){let a=b.choices[c.index];null!=c.delta.content&&a.message?.role==="assistant"&&a.message?.content&&(this._emit("content",c.delta.content,a.message.content),this._emit("content.delta",{delta:c.delta.content,snapshot:a.message.content,parsed:a.message.parsed})),null!=c.delta.refusal&&a.message?.role==="assistant"&&a.message?.refusal&&this._emit("refusal.delta",{delta:c.delta.refusal,snapshot:a.message.refusal}),c.logprobs?.content!=null&&a.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:c.logprobs?.content,snapshot:a.logprobs?.content??[]}),c.logprobs?.refusal!=null&&a.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:c.logprobs?.refusal,snapshot:a.logprobs?.refusal??[]});let d=dN(this,$,"m",ad).call(this,a);for(let b of(a.finish_reason&&(dN(this,$,"m",ag).call(this,a),null!=d.current_tool_call_index&&dN(this,$,"m",af).call(this,a,d.current_tool_call_index)),c.delta.tool_calls??[]))d.current_tool_call_index!==b.index&&(dN(this,$,"m",ag).call(this,a),null!=d.current_tool_call_index&&dN(this,$,"m",af).call(this,a,d.current_tool_call_index)),d.current_tool_call_index=b.index;for(let b of c.delta.tool_calls??[]){let c=a.message.tool_calls?.[b.index];c?.type&&(c?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:c.function?.name,index:b.index,arguments:c.function.arguments,parsed_arguments:c.function.parsed_arguments,arguments_delta:b.function?.arguments??""}):c?.type)}}},af=function(a,b){if(dN(this,$,"m",ad).call(this,a).done_tool_calls.has(b))return;let c=a.message.tool_calls?.[b];if(!c)throw Error("no tool call snapshot");if(!c.type)throw Error("tool call snapshot missing `type`");if("function"===c.type){let a=dN(this,_,"f")?.tools?.find(a=>"function"===a.type&&a.function.name===c.function.name);this._emit("tool_calls.function.arguments.done",{name:c.function.name,index:b,arguments:c.function.arguments,parsed_arguments:dC(a)?a.$parseRaw(c.function.arguments):a?.function.strict?JSON.parse(c.function.arguments):null})}else c.type},ag=function(a){let b=dN(this,$,"m",ad).call(this,a);if(a.message.content&&!b.content_done){b.content_done=!0;let c=dN(this,$,"m",ai).call(this);this._emit("content.done",{content:a.message.content,parsed:c?c.$parseRaw(a.message.content):null})}a.message.refusal&&!b.refusal_done&&(b.refusal_done=!0,this._emit("refusal.done",{refusal:a.message.refusal})),a.logprobs?.content&&!b.logprobs_content_done&&(b.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:a.logprobs.content})),a.logprobs?.refusal&&!b.logprobs_refusal_done&&(b.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:a.logprobs.refusal}))},ah=function(){if(this.ended)throw new bM("stream has ended, this shouldn't happen");let a=dN(this,ab,"f");if(!a)throw new bM("request ended without sending any chunks");return dM(this,ab,void 0,"f"),dM(this,aa,[],"f"),function(a,b){var c;let{id:d,choices:e,created:f,model:g,system_fingerprint:h,...i}=a;return c={...i,id:d,choices:e.map(({message:b,finish_reason:c,index:d,logprobs:e,...f})=>{if(!c)throw new bM(`missing finish_reason for choice ${d}`);let{content:g=null,function_call:h,tool_calls:i,...j}=b,k=b.role;if(!k)throw new bM(`missing role for choice ${d}`);if(h){let{arguments:a,name:i}=h;if(null==a)throw new bM(`missing function_call.arguments for choice ${d}`);if(!i)throw new bM(`missing function_call.name for choice ${d}`);return{...f,message:{content:g,function_call:{arguments:a,name:i},role:k,refusal:b.refusal??null},finish_reason:c,index:d,logprobs:e}}return i?{...f,index:d,finish_reason:c,logprobs:e,message:{...j,role:k,content:g,refusal:b.refusal??null,tool_calls:i.map((b,c)=>{let{function:e,type:f,id:g,...h}=b,{arguments:i,name:j,...k}=e||{};if(null==g)throw new bM(`missing choices[${d}].tool_calls[${c}].id
${dP(a)}`);if(null==f)throw new bM(`missing choices[${d}].tool_calls[${c}].type
${dP(a)}`);if(null==j)throw new bM(`missing choices[${d}].tool_calls[${c}].function.name
${dP(a)}`);if(null==i)throw new bM(`missing choices[${d}].tool_calls[${c}].function.arguments
${dP(a)}`);return{...h,id:g,type:f,function:{...k,name:j,arguments:i}}})}}:{...f,message:{...j,content:g,role:k,refusal:b.refusal??null},finish_reason:c,index:d,logprobs:e}}),created:f,model:g,object:"chat.completion",...h?{system_fingerprint:h}:{}},b&&dE(b)?dD(c,b):{...c,choices:c.choices.map(a=>({...a,message:{...a.message,parsed:null,...a.message.tool_calls?{tool_calls:a.message.tool_calls}:void 0}}))}}(a,dN(this,_,"f"))},ai=function(){let a=dN(this,_,"f")?.response_format;return dB(a)?a:null},aj=function(a){var b,c,d,e;let f=dN(this,ab,"f"),{choices:g,...h}=a;for(let{delta:g,finish_reason:i,index:j,logprobs:k=null,...l}of(f?Object.assign(f,h):f=dM(this,ab,{...h,choices:[]},"f"),a.choices)){let a=f.choices[j];if(a||(a=f.choices[j]={finish_reason:i,index:j,message:{},logprobs:k,...l}),k)if(a.logprobs){let{content:d,refusal:e,...f}=k;Object.assign(a.logprobs,f),d&&((b=a.logprobs).content??(b.content=[]),a.logprobs.content.push(...d)),e&&((c=a.logprobs).refusal??(c.refusal=[]),a.logprobs.refusal.push(...e))}else a.logprobs=Object.assign({},k);if(i&&(a.finish_reason=i,dN(this,_,"f")&&dE(dN(this,_,"f")))){if("length"===i)throw new bZ;if("content_filter"===i)throw new b$}if(Object.assign(a,l),!g)continue;let{content:h,refusal:m,function_call:n,role:o,tool_calls:p,...q}=g;if(Object.assign(a.message,q),m&&(a.message.refusal=(a.message.refusal||"")+m),o&&(a.message.role=o),n&&(a.message.function_call?(n.name&&(a.message.function_call.name=n.name),n.arguments&&((d=a.message.function_call).arguments??(d.arguments=""),a.message.function_call.arguments+=n.arguments)):a.message.function_call=n),h&&(a.message.content=(a.message.content||"")+h,!a.message.refusal&&dN(this,$,"m",ai).call(this)&&(a.message.parsed=dL(a.message.content))),p)for(let{index:b,id:c,type:d,function:f,...g}of(a.message.tool_calls||(a.message.tool_calls=[]),p)){let h=(e=a.message.tool_calls)[b]??(e[b]={});Object.assign(h,g),c&&(h.id=c),d&&(h.type=d),f&&(h.function??(h.function={name:f.name??"",arguments:""})),f?.name&&(h.function.name=f.name),f?.arguments&&(h.function.arguments+=f.arguments,function(a,b){if(!a)return!1;let c=a.tools?.find(a=>a.function?.name===b.function.name);return dC(c)||c?.function.strict||!1}(dN(this,_,"f"),h)&&(h.function.parsed_arguments=dL(h.function.arguments)))}}return f},Symbol.asyncIterator)](){let a=[],b=[],c=!1;return this.on("chunk",c=>{let d=b.shift();d?d.resolve(c):a.push(c)}),this.on("end",()=>{for(let a of(c=!0,b))a.resolve(void 0);b.length=0}),this.on("abort",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),this.on("error",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),{next:async()=>a.length?{value:a.shift(),done:!1}:c?{value:void 0,done:!0}:new Promise((a,c)=>b.push({resolve:a,reject:c})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new b3(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function dP(a){return JSON.stringify(a)}class dQ extends dO{static fromReadableStream(a){let b=new dQ(null);return b._run(()=>b._fromReadableStream(a)),b}static runFunctions(a,b,c){let d=new dQ(null),e={...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return d._run(()=>d._runFunctions(a,b,e)),d}static runTools(a,b,c){let d=new dQ(b),e={...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"runTools"}};return d._run(()=>d._runTools(a,b,e)),d}}class dR extends cN{parse(a,b){for(let b of a.tools??[]){if("function"!==b.type)throw new bM(`Currently only \`function\` tool types support auto-parsing; Received \`${b.type}\``);if(!0!==b.function.strict)throw new bM(`The \`${b.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}return this._client.chat.completions.create(a,{...b,headers:{...b?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(b=>dD(b,a))}runFunctions(a,b){return a.stream?dQ.runFunctions(this._client,a,b):dH.runFunctions(this._client,a,b)}runTools(a,b){return a.stream?dQ.runTools(this._client,a,b):dH.runTools(this._client,a,b)}stream(a,b){return dO.createChatCompletion(this._client,a,b)}}class dS extends cN{constructor(){super(...arguments),this.completions=new dR(this._client)}}(dS||(dS={})).Completions=dR;class dT extends cN{create(a,b){return this._client.post("/realtime/sessions",{body:a,...b,headers:{"OpenAI-Beta":"assistants=v2",...b?.headers}})}}class dU extends cN{create(a,b){return this._client.post("/realtime/transcription_sessions",{body:a,...b,headers:{"OpenAI-Beta":"assistants=v2",...b?.headers}})}}class dV extends cN{constructor(){super(...arguments),this.sessions=new dT(this._client),this.transcriptionSessions=new dU(this._client)}}dV.Sessions=dT,dV.TranscriptionSessions=dU;var dW=function(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)},dX=function(a,b,c,d,e){if("m"===d)throw TypeError("Private method is not writable");if("a"===d&&!e)throw TypeError("Private accessor was defined without a setter");if("function"==typeof b?a!==b||!e:!b.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===d?e.call(a,c):e?e.value=c:b.set(a,c),c};class dY extends dA{constructor(){super(...arguments),ak.add(this),al.set(this,[]),am.set(this,{}),an.set(this,{}),ao.set(this,void 0),ap.set(this,void 0),aq.set(this,void 0),ar.set(this,void 0),as.set(this,void 0),at.set(this,void 0),au.set(this,void 0),av.set(this,void 0),aw.set(this,void 0)}[(al=new WeakMap,am=new WeakMap,an=new WeakMap,ao=new WeakMap,ap=new WeakMap,aq=new WeakMap,ar=new WeakMap,as=new WeakMap,at=new WeakMap,au=new WeakMap,av=new WeakMap,aw=new WeakMap,ak=new WeakSet,Symbol.asyncIterator)](){let a=[],b=[],c=!1;return this.on("event",c=>{let d=b.shift();d?d.resolve(c):a.push(c)}),this.on("end",()=>{for(let a of(c=!0,b))a.resolve(void 0);b.length=0}),this.on("abort",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),this.on("error",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),{next:async()=>a.length?{value:a.shift(),done:!1}:c?{value:void 0,done:!0}:new Promise((a,c)=>b.push({resolve:a,reject:c})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(a){let b=new dY;return b._run(()=>b._fromReadableStream(a)),b}async _fromReadableStream(a,b){let c=b?.signal;c&&(c.aborted&&this.controller.abort(),c.addEventListener("abort",()=>this.controller.abort())),this._connected();let d=b3.fromReadableStream(a,this.controller);for await(let a of d)dW(this,ak,"m",ax).call(this,a);if(d.controller.signal?.aborted)throw new bO;return this._addRun(dW(this,ak,"m",ay).call(this))}toReadableStream(){return new b3(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(a,b,c,d,e){let f=new dY;return f._run(()=>f._runToolAssistantStream(a,b,c,d,{...e,headers:{...e?.headers,"X-Stainless-Helper-Method":"stream"}})),f}async _createToolAssistantStream(a,b,c,d,e){let f=e?.signal;f&&(f.aborted&&this.controller.abort(),f.addEventListener("abort",()=>this.controller.abort()));let g={...d,stream:!0},h=await a.submitToolOutputs(b,c,g,{...e,signal:this.controller.signal});for await(let a of(this._connected(),h))dW(this,ak,"m",ax).call(this,a);if(h.controller.signal?.aborted)throw new bO;return this._addRun(dW(this,ak,"m",ay).call(this))}static createThreadAssistantStream(a,b,c){let d=new dY;return d._run(()=>d._threadAssistantStream(a,b,{...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"stream"}})),d}static createAssistantStream(a,b,c,d){let e=new dY;return e._run(()=>e._runAssistantStream(a,b,c,{...d,headers:{...d?.headers,"X-Stainless-Helper-Method":"stream"}})),e}currentEvent(){return dW(this,au,"f")}currentRun(){return dW(this,av,"f")}currentMessageSnapshot(){return dW(this,ao,"f")}currentRunStepSnapshot(){return dW(this,aw,"f")}async finalRunSteps(){return await this.done(),Object.values(dW(this,am,"f"))}async finalMessages(){return await this.done(),Object.values(dW(this,an,"f"))}async finalRun(){if(await this.done(),!dW(this,ap,"f"))throw Error("Final run was not received.");return dW(this,ap,"f")}async _createThreadAssistantStream(a,b,c){let d=c?.signal;d&&(d.aborted&&this.controller.abort(),d.addEventListener("abort",()=>this.controller.abort()));let e={...b,stream:!0},f=await a.createAndRun(e,{...c,signal:this.controller.signal});for await(let a of(this._connected(),f))dW(this,ak,"m",ax).call(this,a);if(f.controller.signal?.aborted)throw new bO;return this._addRun(dW(this,ak,"m",ay).call(this))}async _createAssistantStream(a,b,c,d){let e=d?.signal;e&&(e.aborted&&this.controller.abort(),e.addEventListener("abort",()=>this.controller.abort()));let f={...c,stream:!0},g=await a.create(b,f,{...d,signal:this.controller.signal});for await(let a of(this._connected(),g))dW(this,ak,"m",ax).call(this,a);if(g.controller.signal?.aborted)throw new bO;return this._addRun(dW(this,ak,"m",ay).call(this))}static accumulateDelta(a,b){for(let[c,d]of Object.entries(b)){if(!a.hasOwnProperty(c)){a[c]=d;continue}let b=a[c];if(null==b||"index"===c||"type"===c){a[c]=d;continue}if("string"==typeof b&&"string"==typeof d)b+=d;else if("number"==typeof b&&"number"==typeof d)b+=d;else if(cM(b)&&cM(d))b=this.accumulateDelta(b,d);else if(Array.isArray(b)&&Array.isArray(d)){if(b.every(a=>"string"==typeof a||"number"==typeof a)){b.push(...d);continue}for(let a of d){if(!cM(a))throw Error(`Expected array delta entry to be an object but got: ${a}`);let c=a.index;if(null==c)throw console.error(a),Error("Expected array delta entry to have an `index` property");if("number"!=typeof c)throw Error(`Expected array delta entry \`index\` property to be a number but got ${c}`);let d=b[c];null==d?b.push(a):b[c]=this.accumulateDelta(d,a)}continue}else throw Error(`Unhandled record type: ${c}, deltaValue: ${d}, accValue: ${b}`);a[c]=b}return a}_addRun(a){return a}async _threadAssistantStream(a,b,c){return await this._createThreadAssistantStream(b,a,c)}async _runAssistantStream(a,b,c,d){return await this._createAssistantStream(b,a,c,d)}async _runToolAssistantStream(a,b,c,d,e){return await this._createToolAssistantStream(c,a,b,d,e)}}ax=function(a){if(!this.ended)switch(dX(this,au,a,"f"),dW(this,ak,"m",aB).call(this,a),a.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":dW(this,ak,"m",aF).call(this,a);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":dW(this,ak,"m",aA).call(this,a);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":dW(this,ak,"m",az).call(this,a);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},ay=function(){if(this.ended)throw new bM("stream has ended, this shouldn't happen");if(!dW(this,ap,"f"))throw Error("Final run has not been received");return dW(this,ap,"f")},az=function(a){let[b,c]=dW(this,ak,"m",aD).call(this,a,dW(this,ao,"f"));for(let a of(dX(this,ao,b,"f"),dW(this,an,"f")[b.id]=b,c)){let c=b.content[a.index];c?.type=="text"&&this._emit("textCreated",c.text)}switch(a.event){case"thread.message.created":this._emit("messageCreated",a.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",a.data.delta,b),a.data.delta.content)for(let c of a.data.delta.content){if("text"==c.type&&c.text){let a=c.text,d=b.content[c.index];if(d&&"text"==d.type)this._emit("textDelta",a,d.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(c.index!=dW(this,aq,"f")){if(dW(this,ar,"f"))switch(dW(this,ar,"f").type){case"text":this._emit("textDone",dW(this,ar,"f").text,dW(this,ao,"f"));break;case"image_file":this._emit("imageFileDone",dW(this,ar,"f").image_file,dW(this,ao,"f"))}dX(this,aq,c.index,"f")}dX(this,ar,b.content[c.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==dW(this,aq,"f")){let b=a.data.content[dW(this,aq,"f")];if(b)switch(b.type){case"image_file":this._emit("imageFileDone",b.image_file,dW(this,ao,"f"));break;case"text":this._emit("textDone",b.text,dW(this,ao,"f"))}}dW(this,ao,"f")&&this._emit("messageDone",a.data),dX(this,ao,void 0,"f")}},aA=function(a){let b=dW(this,ak,"m",aC).call(this,a);switch(dX(this,aw,b,"f"),a.event){case"thread.run.step.created":this._emit("runStepCreated",a.data);break;case"thread.run.step.delta":let c=a.data.delta;if(c.step_details&&"tool_calls"==c.step_details.type&&c.step_details.tool_calls&&"tool_calls"==b.step_details.type)for(let a of c.step_details.tool_calls)a.index==dW(this,as,"f")?this._emit("toolCallDelta",a,b.step_details.tool_calls[a.index]):(dW(this,at,"f")&&this._emit("toolCallDone",dW(this,at,"f")),dX(this,as,a.index,"f"),dX(this,at,b.step_details.tool_calls[a.index],"f"),dW(this,at,"f")&&this._emit("toolCallCreated",dW(this,at,"f")));this._emit("runStepDelta",a.data.delta,b);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":dX(this,aw,void 0,"f"),"tool_calls"==a.data.step_details.type&&dW(this,at,"f")&&(this._emit("toolCallDone",dW(this,at,"f")),dX(this,at,void 0,"f")),this._emit("runStepDone",a.data,b)}},aB=function(a){dW(this,al,"f").push(a),this._emit("event",a)},aC=function(a){switch(a.event){case"thread.run.step.created":return dW(this,am,"f")[a.data.id]=a.data,a.data;case"thread.run.step.delta":let b=dW(this,am,"f")[a.data.id];if(!b)throw Error("Received a RunStepDelta before creation of a snapshot");let c=a.data;if(c.delta){let d=dY.accumulateDelta(b,c.delta);dW(this,am,"f")[a.data.id]=d}return dW(this,am,"f")[a.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":dW(this,am,"f")[a.data.id]=a.data}if(dW(this,am,"f")[a.data.id])return dW(this,am,"f")[a.data.id];throw Error("No snapshot available")},aD=function(a,b){let c=[];switch(a.event){case"thread.message.created":return[a.data,c];case"thread.message.delta":if(!b)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let d=a.data;if(d.delta.content)for(let a of d.delta.content)if(a.index in b.content){let c=b.content[a.index];b.content[a.index]=dW(this,ak,"m",aE).call(this,a,c)}else b.content[a.index]=a,c.push(a);return[b,c];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(b)return[b,c];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},aE=function(a,b){return dY.accumulateDelta(b,a)},aF=function(a){switch(dX(this,av,a.data,"f"),a.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":dX(this,ap,a.data,"f"),dW(this,at,"f")&&(this._emit("toolCallDone",dW(this,at,"f")),dX(this,at,void 0,"f"))}};class dZ extends cN{create(a,b,c){return this._client.post(`/threads/${a}/messages`,{body:b,...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}retrieve(a,b,c){return this._client.get(`/threads/${a}/messages/${b}`,{...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}update(a,b,c,d){return this._client.post(`/threads/${a}/messages/${b}`,{body:c,...d,headers:{"OpenAI-Beta":"assistants=v2",...d?.headers}})}list(a,b={},c){return cu(b)?this.list(a,{},b):this._client.getAPIList(`/threads/${a}/messages`,d$,{query:b,...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}del(a,b,c){return this._client.delete(`/threads/${a}/messages/${b}`,{...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}}class d$ extends cR{}dZ.MessagesPage=d$;class d_ extends cN{retrieve(a,b,c,d={},e){return cu(d)?this.retrieve(a,b,c,{},d):this._client.get(`/threads/${a}/runs/${b}/steps/${c}`,{query:d,...e,headers:{"OpenAI-Beta":"assistants=v2",...e?.headers}})}list(a,b,c={},d){return cu(c)?this.list(a,b,{},c):this._client.getAPIList(`/threads/${a}/runs/${b}/steps`,d0,{query:c,...d,headers:{"OpenAI-Beta":"assistants=v2",...d?.headers}})}}class d0 extends cR{}d_.RunStepsPage=d0;class d1 extends cN{constructor(){super(...arguments),this.steps=new d_(this._client)}create(a,b,c){let{include:d,...e}=b;return this._client.post(`/threads/${a}/runs`,{query:{include:d},body:e,...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers},stream:b.stream??!1})}retrieve(a,b,c){return this._client.get(`/threads/${a}/runs/${b}`,{...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}update(a,b,c,d){return this._client.post(`/threads/${a}/runs/${b}`,{body:c,...d,headers:{"OpenAI-Beta":"assistants=v2",...d?.headers}})}list(a,b={},c){return cu(b)?this.list(a,{},b):this._client.getAPIList(`/threads/${a}/runs`,d2,{query:b,...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}cancel(a,b,c){return this._client.post(`/threads/${a}/runs/${b}/cancel`,{...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}async createAndPoll(a,b,c){let d=await this.create(a,b,c);return await this.poll(a,d.id,c)}createAndStream(a,b,c){return dY.createAssistantStream(a,this._client.beta.threads.runs,b,c)}async poll(a,b,c){let d={...c?.headers,"X-Stainless-Poll-Helper":"true"};for(c?.pollIntervalMs&&(d["X-Stainless-Custom-Poll-Interval"]=c.pollIntervalMs.toString());;){let{data:e,response:f}=await this.retrieve(a,b,{...c,headers:{...c?.headers,...d}}).withResponse();switch(e.status){case"queued":case"in_progress":case"cancelling":let g=5e3;if(c?.pollIntervalMs)g=c.pollIntervalMs;else{let a=f.headers.get("openai-poll-after-ms");if(a){let b=parseInt(a);isNaN(b)||(g=b)}}await cB(g);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return e}}}stream(a,b,c){return dY.createAssistantStream(a,this._client.beta.threads.runs,b,c)}submitToolOutputs(a,b,c,d){return this._client.post(`/threads/${a}/runs/${b}/submit_tool_outputs`,{body:c,...d,headers:{"OpenAI-Beta":"assistants=v2",...d?.headers},stream:c.stream??!1})}async submitToolOutputsAndPoll(a,b,c,d){let e=await this.submitToolOutputs(a,b,c,d);return await this.poll(a,e.id,d)}submitToolOutputsStream(a,b,c,d){return dY.createToolAssistantStream(a,b,this._client.beta.threads.runs,c,d)}}class d2 extends cR{}d1.RunsPage=d2,d1.Steps=d_,d1.RunStepsPage=d0;class d3 extends cN{constructor(){super(...arguments),this.runs=new d1(this._client),this.messages=new dZ(this._client)}create(a={},b){return cu(a)?this.create({},a):this._client.post("/threads",{body:a,...b,headers:{"OpenAI-Beta":"assistants=v2",...b?.headers}})}retrieve(a,b){return this._client.get(`/threads/${a}`,{...b,headers:{"OpenAI-Beta":"assistants=v2",...b?.headers}})}update(a,b,c){return this._client.post(`/threads/${a}`,{body:b,...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}del(a,b){return this._client.delete(`/threads/${a}`,{...b,headers:{"OpenAI-Beta":"assistants=v2",...b?.headers}})}createAndRun(a,b){return this._client.post("/threads/runs",{body:a,...b,headers:{"OpenAI-Beta":"assistants=v2",...b?.headers},stream:a.stream??!1})}async createAndRunPoll(a,b){let c=await this.createAndRun(a,b);return await this.runs.poll(c.thread_id,c.id,b)}createAndRunStream(a,b){return dY.createThreadAssistantStream(a,this._client.beta.threads,b)}}d3.Runs=d1,d3.RunsPage=d2,d3.Messages=dZ,d3.MessagesPage=d$;class d4 extends cN{constructor(){super(...arguments),this.realtime=new dV(this._client),this.chat=new dS(this._client),this.assistants=new ds(this._client),this.threads=new d3(this._client)}}d4.Realtime=dV,d4.Assistants=ds,d4.AssistantsPage=dt,d4.Threads=d3;class d5 extends cN{create(a,b){return this._client.post("/batches",{body:a,...b})}retrieve(a,b){return this._client.get(`/batches/${a}`,b)}list(a={},b){return cu(a)?this.list({},a):this._client.getAPIList("/batches",d6,{query:a,...b})}cancel(a,b){return this._client.post(`/batches/${a}/cancel`,b)}}class d6 extends cR{}d5.BatchesPage=d6;class d7 extends cN{create(a,b,c){return this._client.post(`/uploads/${a}/parts`,cg({body:b,...c}))}}class d8 extends cN{constructor(){super(...arguments),this.parts=new d7(this._client)}create(a,b){return this._client.post("/uploads",{body:a,...b})}cancel(a,b){return this._client.post(`/uploads/${a}/cancel`,b)}complete(a,b,c){return this._client.post(`/uploads/${a}/complete`,{body:b,...c})}}function d9(a,b){let c=a.output.map(a=>{if("function_call"===a.type)return{...a,parsed_arguments:function(a,b){var c,d;let e=(c=a.tools??[],d=b.name,c.find(a=>"function"===a.type&&a.name===d));return{...b,...b,parsed_arguments:e?.$brand==="auto-parseable-tool"?e.$parseRaw(b.arguments):e?.strict?JSON.parse(b.arguments):null}}(b,a)};if("message"===a.type){let c=a.content.map(a=>{var c,d;return"output_text"===a.type?{...a,parsed:(c=b,d=a.text,c.text?.format?.type!=="json_schema"?null:"$parseRaw"in c.text?.format?(c.text?.format).$parseRaw(d):JSON.parse(d))}:a});return{...a,content:c}}return a}),d=Object.assign({},a,{output:c});return Object.getOwnPropertyDescriptor(a,"output_text")||ea(d),Object.defineProperty(d,"output_parsed",{enumerable:!0,get(){for(let a of d.output)if("message"===a.type){for(let b of a.content)if("output_text"===b.type&&null!==b.parsed)return b.parsed}return null}}),d}function ea(a){let b=[];for(let c of a.output)if("message"===c.type)for(let a of c.content)"output_text"===a.type&&b.push(a.text);a.output_text=b.join("")}d8.Parts=d7;class eb extends cN{list(a,b={},c){return cu(b)?this.list(a,{},b):this._client.getAPIList(`/responses/${a}/input_items`,eg,{query:b,...c})}}var ec=function(a,b,c,d,e){if("m"===d)throw TypeError("Private method is not writable");if("a"===d&&!e)throw TypeError("Private accessor was defined without a setter");if("function"==typeof b?a!==b||!e:!b.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===d?e.call(a,c):e?e.value=c:b.set(a,c),c},ed=function(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)};class ee extends dA{constructor(a){super(),aG.add(this),aH.set(this,void 0),aI.set(this,void 0),aJ.set(this,void 0),ec(this,aH,a,"f")}static createResponse(a,b,c){let d=new ee(b);return d._run(()=>d._createOrRetrieveResponse(a,b,{...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"stream"}})),d}async _createOrRetrieveResponse(a,b,c){let d,e=c?.signal;e&&(e.aborted&&this.controller.abort(),e.addEventListener("abort",()=>this.controller.abort())),ed(this,aG,"m",aK).call(this);let f=null;for await(let e of("response_id"in b?(d=await a.responses.retrieve(b.response_id,{stream:!0},{...c,signal:this.controller.signal,stream:!0}),f=b.starting_after??null):d=await a.responses.create({...b,stream:!0},{...c,signal:this.controller.signal}),this._connected(),d))ed(this,aG,"m",aL).call(this,e,f);if(d.controller.signal?.aborted)throw new bO;return ed(this,aG,"m",aM).call(this)}[(aH=new WeakMap,aI=new WeakMap,aJ=new WeakMap,aG=new WeakSet,aK=function(){this.ended||ec(this,aI,void 0,"f")},aL=function(a,b){if(this.ended)return;let c=(a,c)=>{(null==b||c.sequence_number>b)&&this._emit(a,c)},d=ed(this,aG,"m",aN).call(this,a);switch(c("event",a),a.type){case"response.output_text.delta":{let b=d.output[a.output_index];if(!b)throw new bM(`missing output at index ${a.output_index}`);if("message"===b.type){let d=b.content[a.content_index];if(!d)throw new bM(`missing content at index ${a.content_index}`);if("output_text"!==d.type)throw new bM(`expected content to be 'output_text', got ${d.type}`);c("response.output_text.delta",{...a,snapshot:d.text})}break}case"response.function_call_arguments.delta":{let b=d.output[a.output_index];if(!b)throw new bM(`missing output at index ${a.output_index}`);"function_call"===b.type&&c("response.function_call_arguments.delta",{...a,snapshot:b.arguments});break}default:c(a.type,a)}},aM=function(){if(this.ended)throw new bM("stream has ended, this shouldn't happen");let a=ed(this,aI,"f");if(!a)throw new bM("request ended without sending any events");ec(this,aI,void 0,"f");let b=function(a,b){var c;return b&&(c=b,dB(c.text?.format))?d9(a,b):{...a,output_parsed:null,output:a.output.map(a=>"function_call"===a.type?{...a,parsed_arguments:null}:"message"===a.type?{...a,content:a.content.map(a=>({...a,parsed:null}))}:a)}}(a,ed(this,aH,"f"));return ec(this,aJ,b,"f"),b},aN=function(a){let b=ed(this,aI,"f");if(!b){if("response.created"!==a.type)throw new bM(`When snapshot hasn't been set yet, expected 'response.created' event, got ${a.type}`);return ec(this,aI,a.response,"f")}switch(a.type){case"response.output_item.added":b.output.push(a.item);break;case"response.content_part.added":{let c=b.output[a.output_index];if(!c)throw new bM(`missing output at index ${a.output_index}`);"message"===c.type&&c.content.push(a.part);break}case"response.output_text.delta":{let c=b.output[a.output_index];if(!c)throw new bM(`missing output at index ${a.output_index}`);if("message"===c.type){let b=c.content[a.content_index];if(!b)throw new bM(`missing content at index ${a.content_index}`);if("output_text"!==b.type)throw new bM(`expected content to be 'output_text', got ${b.type}`);b.text+=a.delta}break}case"response.function_call_arguments.delta":{let c=b.output[a.output_index];if(!c)throw new bM(`missing output at index ${a.output_index}`);"function_call"===c.type&&(c.arguments+=a.delta);break}case"response.completed":ec(this,aI,a.response,"f")}return b},Symbol.asyncIterator)](){let a=[],b=[],c=!1;return this.on("event",c=>{let d=b.shift();d?d.resolve(c):a.push(c)}),this.on("end",()=>{for(let a of(c=!0,b))a.resolve(void 0);b.length=0}),this.on("abort",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),this.on("error",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),{next:async()=>a.length?{value:a.shift(),done:!1}:c?{value:void 0,done:!0}:new Promise((a,c)=>b.push({resolve:a,reject:c})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let a=ed(this,aJ,"f");if(!a)throw new bM("stream ended without producing a ChatCompletion");return a}}class ef extends cN{constructor(){super(...arguments),this.inputItems=new eb(this._client)}create(a,b){return this._client.post("/responses",{body:a,...b,stream:a.stream??!1})._thenUnwrap(a=>("object"in a&&"response"===a.object&&ea(a),a))}retrieve(a,b={},c){return this._client.get(`/responses/${a}`,{query:b,...c,stream:b?.stream??!1})}del(a,b){return this._client.delete(`/responses/${a}`,{...b,headers:{Accept:"*/*",...b?.headers}})}parse(a,b){return this._client.responses.create(a,b)._thenUnwrap(b=>d9(b,a))}stream(a,b){return ee.createResponse(this._client,a,b)}cancel(a,b){return this._client.post(`/responses/${a}/cancel`,{...b,headers:{Accept:"*/*",...b?.headers}})}}class eg extends cR{}ef.InputItems=eb;class eh extends cN{retrieve(a,b,c,d){return this._client.get(`/evals/${a}/runs/${b}/output_items/${c}`,d)}list(a,b,c={},d){return cu(c)?this.list(a,b,{},c):this._client.getAPIList(`/evals/${a}/runs/${b}/output_items`,ei,{query:c,...d})}}class ei extends cR{}eh.OutputItemListResponsesPage=ei;class ej extends cN{constructor(){super(...arguments),this.outputItems=new eh(this._client)}create(a,b,c){return this._client.post(`/evals/${a}/runs`,{body:b,...c})}retrieve(a,b,c){return this._client.get(`/evals/${a}/runs/${b}`,c)}list(a,b={},c){return cu(b)?this.list(a,{},b):this._client.getAPIList(`/evals/${a}/runs`,ek,{query:b,...c})}del(a,b,c){return this._client.delete(`/evals/${a}/runs/${b}`,c)}cancel(a,b,c){return this._client.post(`/evals/${a}/runs/${b}`,c)}}class ek extends cR{}ej.RunListResponsesPage=ek,ej.OutputItems=eh,ej.OutputItemListResponsesPage=ei;class el extends cN{constructor(){super(...arguments),this.runs=new ej(this._client)}create(a,b){return this._client.post("/evals",{body:a,...b})}retrieve(a,b){return this._client.get(`/evals/${a}`,b)}update(a,b,c){return this._client.post(`/evals/${a}`,{body:b,...c})}list(a={},b){return cu(a)?this.list({},a):this._client.getAPIList("/evals",em,{query:a,...b})}del(a,b){return this._client.delete(`/evals/${a}`,b)}}class em extends cR{}el.EvalListResponsesPage=em,el.Runs=ej,el.RunListResponsesPage=ek;class en extends cN{retrieve(a,b,c){return this._client.get(`/containers/${a}/files/${b}/content`,{...c,headers:{Accept:"application/binary",...c?.headers},__binaryResponse:!0})}}class eo extends cN{constructor(){super(...arguments),this.content=new en(this._client)}create(a,b,c){return this._client.post(`/containers/${a}/files`,cg({body:b,...c}))}retrieve(a,b,c){return this._client.get(`/containers/${a}/files/${b}`,c)}list(a,b={},c){return cu(b)?this.list(a,{},b):this._client.getAPIList(`/containers/${a}/files`,ep,{query:b,...c})}del(a,b,c){return this._client.delete(`/containers/${a}/files/${b}`,{...c,headers:{Accept:"*/*",...c?.headers}})}}class ep extends cR{}eo.FileListResponsesPage=ep,eo.Content=en;class eq extends cN{constructor(){super(...arguments),this.files=new eo(this._client)}create(a,b){return this._client.post("/containers",{body:a,...b})}retrieve(a,b){return this._client.get(`/containers/${a}`,b)}list(a={},b){return cu(a)?this.list({},a):this._client.getAPIList("/containers",er,{query:a,...b})}del(a,b){return this._client.delete(`/containers/${a}`,{...b,headers:{Accept:"*/*",...b?.headers}})}}class er extends cR{}eq.ContainerListResponsesPage=er,eq.Files=eo,eq.FileListResponsesPage=ep;class es extends cp{constructor({baseURL:a=cE("OPENAI_BASE_URL"),apiKey:b=cE("OPENAI_API_KEY"),organization:c=cE("OPENAI_ORG_ID")??null,project:d=cE("OPENAI_PROJECT_ID")??null,...e}={}){if(void 0===b)throw new bM("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let f={apiKey:b,organization:c,project:d,...e,baseURL:a||"https://api.openai.com/v1"};if(!f.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new bM("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:f.baseURL,timeout:f.timeout??6e5,httpAgent:f.httpAgent,maxRetries:f.maxRetries,fetch:f.fetch}),this.completions=new cO(this),this.chat=new cV(this),this.embeddings=new cW(this),this.files=new cX(this),this.images=new cZ(this),this.audio=new c1(this),this.moderations=new c2(this),this.models=new c3(this),this.fineTuning=new dg(this),this.graders=new di(this),this.vectorStores=new dp(this),this.beta=new d4(this),this.batches=new d5(this),this.uploads=new d8(this),this.responses=new ef(this),this.evals=new el(this),this.containers=new eq(this),this._options=f,this.apiKey=b,this.organization=c,this.project=d}defaultQuery(){return this._options.defaultQuery}defaultHeaders(a){return{...super.defaultHeaders(a),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(a){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(a){return function(a,b={}){let c,d=a,e=function(a=z){let b;if(void 0!==a.allowEmptyArrays&&"boolean"!=typeof a.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==a.encodeDotInKeys&&"boolean"!=typeof a.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==a.encoder&&void 0!==a.encoder&&"function"!=typeof a.encoder)throw TypeError("Encoder has to be a function.");let c=a.charset||z.charset;if(void 0!==a.charset&&"utf-8"!==a.charset&&"iso-8859-1"!==a.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let d=o;if(void 0!==a.format){if(!t.call(p,a.format))throw TypeError("Unknown format option provided.");d=a.format}let e=p[d],f=z.filter;if(("function"==typeof a.filter||v(a.filter))&&(f=a.filter),b=a.arrayFormat&&a.arrayFormat in u?a.arrayFormat:"indices"in a?a.indices?"indices":"repeat":z.arrayFormat,"commaRoundTrip"in a&&"boolean"!=typeof a.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let g=void 0===a.allowDots?!0==!!a.encodeDotInKeys||z.allowDots:!!a.allowDots;return{addQueryPrefix:"boolean"==typeof a.addQueryPrefix?a.addQueryPrefix:z.addQueryPrefix,allowDots:g,allowEmptyArrays:"boolean"==typeof a.allowEmptyArrays?!!a.allowEmptyArrays:z.allowEmptyArrays,arrayFormat:b,charset:c,charsetSentinel:"boolean"==typeof a.charsetSentinel?a.charsetSentinel:z.charsetSentinel,commaRoundTrip:!!a.commaRoundTrip,delimiter:void 0===a.delimiter?z.delimiter:a.delimiter,encode:"boolean"==typeof a.encode?a.encode:z.encode,encodeDotInKeys:"boolean"==typeof a.encodeDotInKeys?a.encodeDotInKeys:z.encodeDotInKeys,encoder:"function"==typeof a.encoder?a.encoder:z.encoder,encodeValuesOnly:"boolean"==typeof a.encodeValuesOnly?a.encodeValuesOnly:z.encodeValuesOnly,filter:f,format:d,formatter:e,serializeDate:"function"==typeof a.serializeDate?a.serializeDate:z.serializeDate,skipNulls:"boolean"==typeof a.skipNulls?a.skipNulls:z.skipNulls,sort:"function"==typeof a.sort?a.sort:null,strictNullHandling:"boolean"==typeof a.strictNullHandling?a.strictNullHandling:z.strictNullHandling}}(b);"function"==typeof e.filter?d=(0,e.filter)("",d):v(e.filter)&&(c=e.filter);let f=[];if("object"!=typeof d||null===d)return"";let g=u[e.arrayFormat],h="comma"===g&&e.commaRoundTrip;c||(c=Object.keys(d)),e.sort&&c.sort(e.sort);let i=new WeakMap;for(let a=0;a<c.length;++a){let b=c[a];e.skipNulls&&null===d[b]||x(f,function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,t){var u,w;let y,B=b,C=t,D=0,E=!1;for(;void 0!==(C=C.get(A))&&!E;){let a=C.get(b);if(D+=1,void 0!==a)if(a===D)throw RangeError("Cyclic object value");else E=!0;void 0===C.get(A)&&(D=0)}if("function"==typeof k?B=k(c,B):B instanceof Date?B=n?.(B):"comma"===d&&v(B)&&(B=s(B,function(a){return a instanceof Date?n?.(a):a})),null===B){if(g)return j&&!q?j(c,z.encoder,r,"key",o):c;B=""}if("string"==typeof(u=B)||"number"==typeof u||"boolean"==typeof u||"symbol"==typeof u||"bigint"==typeof u||(w=B)&&"object"==typeof w&&w.constructor&&w.constructor.isBuffer&&w.constructor.isBuffer(w)){if(j){let a=q?c:j(c,z.encoder,r,"key",o);return[p?.(a)+"="+p?.(j(B,z.encoder,r,"value",o))]}return[p?.(c)+"="+p?.(String(B))]}let F=[];if(void 0===B)return F;if("comma"===d&&v(B))q&&j&&(B=s(B,j)),y=[{value:B.length>0?B.join(",")||null:void 0}];else if(v(k))y=k;else{let a=Object.keys(B);y=l?a.sort(l):a}let G=i?String(c).replace(/\./g,"%2E"):String(c),H=e&&v(B)&&1===B.length?G+"[]":G;if(f&&v(B)&&0===B.length)return H+"[]";for(let c=0;c<y.length;++c){let s=y[c],u="object"==typeof s&&void 0!==s.value?s.value:B[s];if(h&&null===u)continue;let w=m&&i?s.replace(/\./g,"%2E"):s,z=v(B)?"function"==typeof d?d(H,w):H:H+(m?"."+w:"["+w+"]");t.set(b,D);let C=new WeakMap;C.set(A,t),x(F,a(u,z,d,e,f,g,h,i,"comma"===d&&q&&v(B)?null:j,k,l,m,n,o,p,q,r,C))}return F}(d[b],b,g,h,e.allowEmptyArrays,e.strictNullHandling,e.skipNulls,e.encodeDotInKeys,e.encode?e.encoder:null,e.filter,e.sort,e.allowDots,e.serializeDate,e.format,e.formatter,e.encodeValuesOnly,e.charset,i))}let j=f.join(e.delimiter),k=!0===e.addQueryPrefix?"?":"";return e.charsetSentinel&&("iso-8859-1"===e.charset?k+="utf8=%26%2310003%3B&":k+="utf8=%E2%9C%93&"),j.length>0?k+j:""}(a,{arrayFormat:"brackets"})}}es.OpenAI=es,es.DEFAULT_TIMEOUT=6e5,es.OpenAIError=bM,es.APIError=bN,es.APIConnectionError=bP,es.APIConnectionTimeoutError=bQ,es.APIUserAbortError=bO,es.NotFoundError=bU,es.ConflictError=bV,es.RateLimitError=bX,es.BadRequestError=bR,es.AuthenticationError=bS,es.InternalServerError=bY,es.PermissionDeniedError=bT,es.UnprocessableEntityError=bW,es.toFile=cb,es.fileFromPath=m,es.Completions=cO,es.Chat=cV,es.ChatCompletionsPage=cT,es.Embeddings=cW,es.Files=cX,es.FileObjectsPage=cY,es.Images=cZ,es.Audio=c1,es.Moderations=c2,es.Models=c3,es.ModelsPage=c4,es.FineTuning=dg,es.Graders=di,es.VectorStores=dp,es.VectorStoresPage=dq,es.VectorStoreSearchResponsesPage=dr,es.Beta=d4,es.Batches=d5,es.BatchesPage=d6,es.Uploads=d8,es.Responses=ef,es.Evals=el,es.EvalListResponsesPage=em,es.Containers=eq,es.ContainerListResponsesPage=er;class et extends es{constructor({baseURL:a=cE("OPENAI_BASE_URL"),apiKey:b=cE("AZURE_OPENAI_API_KEY"),apiVersion:c=cE("OPENAI_API_VERSION"),endpoint:d,deployment:e,azureADTokenProvider:f,dangerouslyAllowBrowser:g,...h}={}){if(!c)throw new bM("The OPENAI_API_VERSION environment variable is missing or empty; either provide it, or instantiate the AzureOpenAI client with an apiVersion option, like new AzureOpenAI({ apiVersion: 'My API Version' }).");if("function"==typeof f&&(g=!0),!f&&!b)throw new bM("Missing credentials. Please pass one of `apiKey` and `azureADTokenProvider`, or set the `AZURE_OPENAI_API_KEY` environment variable.");if(f&&b)throw new bM("The `apiKey` and `azureADTokenProvider` arguments are mutually exclusive; only one can be passed at a time.");if(b??(b=ev),h.defaultQuery={...h.defaultQuery,"api-version":c},a){if(d)throw new bM("baseURL and endpoint are mutually exclusive")}else{if(d||(d=process.env.AZURE_OPENAI_ENDPOINT),!d)throw new bM("Must provide one of the `baseURL` or `endpoint` arguments, or the `AZURE_OPENAI_ENDPOINT` environment variable");a=`${d}/openai`}super({apiKey:b,baseURL:a,...h,...void 0!==g?{dangerouslyAllowBrowser:g}:{}}),this.apiVersion="",this._azureADTokenProvider=f,this.apiVersion=c,this.deploymentName=e}buildRequest(a,b={}){if(eu.has(a.path)&&"post"===a.method&&void 0!==a.body){if(!cM(a.body))throw Error("Expected request body to be an object");let b=this.deploymentName||a.body.model||a.__metadata?.model;void 0===b||this.baseURL.includes("/deployments")||(a.path=`/deployments/${b}${a.path}`)}return super.buildRequest(a,b)}async _getAzureADToken(){if("function"==typeof this._azureADTokenProvider){let a=await this._azureADTokenProvider();if(!a||"string"!=typeof a)throw new bM(`Expected 'azureADTokenProvider' argument to return a string but it returned ${a}`);return a}}authHeaders(a){return{}}async prepareOptions(a){if(a.headers?.["api-key"])return super.prepareOptions(a);let b=await this._getAzureADToken();if(a.headers??(a.headers={}),b)a.headers.Authorization=`Bearer ${b}`;else if(this.apiKey!==ev)a.headers["api-key"]=this.apiKey;else throw new bM("Unable to handle auth");return super.prepareOptions(a)}}let eu=new Set(["/completions","/chat/completions","/embeddings","/audio/transcriptions","/audio/translations","/audio/speech","/images/generations","/images/edits"]),ev="<Missing Key>",ew=es}};
//# sourceMappingURL=2953.js.map